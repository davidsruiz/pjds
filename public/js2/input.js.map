{"version":3,"sources":["../js/input.js"],"names":["EventProtocol","listeners","Map","on","addListener","key","handler","listenerList","get","push","set","info","listener","indexOf","splice","Button","id","state","trueHandlers","Set","falseHandlers","ontrue","_ontrue","bind","onfalse","_onfalse","bool","handlerGroup","add","delete","clear","size","Axis","morethanhandlers","lessthanhandlers","onlessthan","_onlessthan","onmorethan","_onmorethan","value","limit","active","Input","_buttons","_axes","button","axis","KeyboardInput","boundHandle","event","handle","startListening","document","addEventListener","keyCode","setState","type","removeEventListener","GamepadInput","refreshing","refreshRate","lookForGamepad","window","setGamepad","e","gamepad","unsetGamepad","navigator","getGamepads","gamepads","startRefreshing","refresh","axes","buttons","refreshAxes","refreshButtons","setTimeout","i","length","axisValue","buttonValue","pressed","abortRefresh","MobileInput","_buttonNodes","_verticalAxisNodes","_horizontalAxisNodes","node","startHandler","endHandler","gestureRecognizer","Hammer","direction","DIRECTION_VERTICAL","deltaY","destroy","DIRECTION_HORIZONTAL","deltaX","InputStack","items","reference","addHandlers","removeHandlers","item","itemIsNotAlreadyPresent","has","valueHasChanged","changeOccurring","callAddItemHandlers","execListeners","callRemoveItemHandlers","handlersForItem","expectingHandler","valueInterpreter","a","setItem","clearItem","itemValue","toString"],"mappings":"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WAAL,CAAiBxE,MAAjB,CAAwB0E,IAAxB;AACA,WAAKD,cAAL,CAAoBzE,MAApB,CAA2B0E,IAA3B;AAED;;AAED;;;;+BAEW;AACT,aAAO,KAAKJ,KAAL,CAAWmB,QAAX,EAAP;AACD;;;;EAnHsBtH,a;;AAyHzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,CAAC,YAAM;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAOD,CApHD","file":"input.js","sourcesContent":["\nclass EventProtocol {\n\n  constructor() {\n    this.listeners = new Map();\n\n    // aliases\n    this.on = this.addListener;\n  }\n\n  addListener(key, handler) {\n\n    if(typeof handler !== 'function')\n      return false;\n\n    const listenerList = this.listeners.get(key) || [];\n    listenerList.push(handler);\n    this.listeners.set(key, listenerList);\n\n    return true; // success\n\n  }\n\n  execListeners(key, info) {\n    const listenerList = this.listeners.get(key) || [];\n    for(let listener of listenerList)\n      listener(info);\n  }\n\n  removeListener(key, handler) {\n    const listenerList = this.listeners.get(key) || [];\n    const indexOf = listenerList.indexOf(handler);\n    if(indexOf === -1) return false; // failure\n    listenerList.splice(indexOf, 1);\n    return true; // success\n  }\n\n}\n\nclass Button {\n\n  constructor(id) {\n\n    this.id = id;\n    this.state = false;\n    this.trueHandlers = new Set();\n    this.falseHandlers = new Set();\n\n    this.ontrue = this._ontrue.bind(this);\n    this.onfalse = this._onfalse.bind(this);\n\n  }\n\n  setState(bool) {\n    if(this.state === bool) return;\n\n    this.state = bool;\n    this.handlerGroup = bool ? this.trueHandlers : this.falseHandlers;\n    for(let handler of this.handlerGroup)\n      handler();\n\n  }\n\n  get hasHandlers() {\n    return (\n      !!this.trueHandlers.size ||\n      !!this.falseHandlers.size\n    );\n  }\n\n  _ontrue(handler) {\n    this.trueHandlers.add(handler);\n  }\n\n  _onfalse(handler) {\n    this.falseHandlers.add(handler);\n  }\n\n  remove(handler) {\n    return (\n      this.trueHandlers.delete(handler) ||\n      this.falseHandlers.delete(handler)\n    );\n  }\n\n  clear() {\n    this.trueHandlers.clear();\n    this.falseHandlers.clear();\n  }\n  reset() {\n    this.clear();\n  }\n\n}\n\nclass Axis {\n\n  constructor(id) {\n\n    this.id = id;\n    this.state = 0;\n    this.morethanhandlers = new Map();\n    this.lessthanhandlers = new Map();\n\n    this.onlessthan = this._onlessthan.bind(this);\n    this.onmorethan = this._onmorethan.bind(this);\n\n  }\n\n  setState(value) {\n    if(this.state === value) return;\n\n    this.state = value;\n    for(let [handler, [limit, active]] of this.morethanhandlers) {\n      if(value > limit) handler(this.state);\n    }\n    for(let [handler, [limit, active]] of this.lessthanhandlers) {\n      if(value < limit) handler(this.state);\n    }\n\n  }\n\n  get hasHandlers() {\n    return (\n      !!this.morethanhandlers.size ||\n      !!this.lessthanhandlers.size\n    );\n  }\n\n  _onmorethan(limit) {\n    return (handler => {\n      this.morethanhandlers.set(handler, [limit, false]);\n    });\n  }\n\n  _onlessthan(limit) {\n    return (handler => {\n      this.lessthanhandlers.set(handler, [limit, false]);\n    });\n  }\n\n  remove(handler) {\n    return (\n      this.morethanhandlers.delete(handler) ||\n      this.lessthanhandlers.delete(handler)\n    );\n  }\n\n  clear() {\n    this.morethanhandlers.clear();\n    this.lessthanhandlers.clear();\n  }\n  reset() {\n    this.clear();\n  }\n\n\n}\n\nclass Input extends EventProtocol {\n\n  constructor() {\n    super();\n\n    this._buttons = new Map();\n    this._axes = new Map();\n\n  }\n\n  button(id) {\n\n    let button = this._buttons.get(id);\n    if(!button) button = new Button(id);\n    this._buttons.set(id, button);\n\n    return button;\n\n  }\n\n  axis(id) {\n\n    let axis = this._axes.get(id);\n    if(!axis) axis = new Axis(id);\n    this._axes.set(id, axis);\n\n    return axis;\n\n  }\n\n}\n\nclass KeyboardInput extends Input {\n\n  constructor() {\n    super();\n\n    this.boundHandle = (event) => this.handle(event);\n    this.startListening();\n  }\n\n\n  // being a keyboard input made up of only keys or _buttons\n  // the keyboard is listening for only keydown and keyup events\n  // to alert the corresponding handlers\n  startListening() {\n\n    document.addEventListener('keydown', this.boundHandle);\n    document.addEventListener('keyup', this.boundHandle);\n\n  }\n\n  handle(event) {\n\n    for(let [id, button] of this._buttons) {\n      if(id != event.keyCode) continue;\n      button.setState(event.type === 'keydown');\n    }\n\n  }\n\n  stopListening() {\n\n    document.removeEventListener('keydown', this.boundHandle);\n    document.removeEventListener('keyup', this.boundHandle);\n\n  }\n\n}\n\nclass GamepadInput extends Input {\n\n  // SETUP AND REFRESH LOOP\n\n  constructor() {\n    super();\n\n    this.refreshing = false;\n    this.refreshRate = 16;\n\n    this.lookForGamepad();\n    window.addEventListener(\"gamepadconnected\", e => this.setGamepad(e.gamepad));\n    window.addEventListener(\"gamepaddisconnected\", e => { this.unsetGamepad(); this.lookForGamepad() });\n\n  }\n\n  lookForGamepad() {\n\n    if(navigator.getGamepads) {\n\n      let gamepads = navigator.getGamepads();\n      for(let gamepad of gamepads) {\n        if(gamepad) {\n          this.setGamepad(gamepad);\n          break;\n        }\n      }\n\n    }\n\n  }\n\n  setGamepad(gamepad) {\n    this.gamepad = gamepad;\n    this.startRefreshing();\n  }\n\n  startRefreshing() {\n    this.refreshing = true;\n    this.refresh();\n  }\n\n  refresh() {\n    if(!this.gamepad || !this.gamepad.axes || !this.gamepad.buttons) this.unsetGamepad();\n    if(!this.refreshing) return;\n\n    this.refreshAxes();\n    this.refreshButtons();\n\n    setTimeout(()=>this.refresh(), this.refreshRate)\n  }\n\n  refreshAxes() {\n\n    for(let i = 0; i < this.gamepad.axes.length; i++) {\n      const axisValue = this.gamepad.axes[i];\n      this.axis(i).setState(axisValue);\n    }\n\n  }\n\n  refreshButtons() {\n\n    for(let i = 0; i < this.gamepad.buttons.length; i++) {\n      const buttonValue = this.gamepad.buttons[i].pressed;\n      this.button(i).setState(buttonValue);\n    }\n\n  }\n\n  abortRefresh() {\n    this.refreshing = false;\n  }\n\n  unsetGamepad() {\n    this.gamepad = null;\n    this.abortRefresh()\n  }\n\n\n\n\n\n}\n\nclass MobileInput extends Input {\n\n  // initial support excludes accelerometer data\n\n  constructor() {\n    super();\n\n    this._buttonNodes = new Map();\n    this._verticalAxisNodes = new Map();\n    this._horizontalAxisNodes = new Map();\n\n  }\n\n  createButton(id, node) {\n    let startHandler = e => {\n      this.button(id).setState(true);\n    };\n    let endHandler = e => {\n      this.button(id).setState(false);\n    };\n    node.addEventListener('touchstart', startHandler);\n    node.addEventListener('touchend', endHandler);\n    this._buttonNodes.set(id, [node, startHandler, endHandler]);\n  }\n\n  deleteButton(id) {\n    let [node, startHandler, endHandler] = this._buttonNodes.get(id);\n    node.removeEventListener('touchstart', startHandler);\n    node.removeEventListener('touchend', endHandler);\n    this._buttonNodes.delete(id);\n  }\n\n  createVerticalAxis(id, node) {\n    const gestureRecognizer = new Hammer(node);\n    gestureRecognizer.get('pan').set({ direction: Hammer.DIRECTION_VERTICAL });\n    gestureRecognizer.on('panmove', e => {\n      this.axis(id).setState(e.deltaY);\n    });\n    gestureRecognizer.on('panend', e => {\n      this.axis(id).setState(0);\n    });\n    this._verticalAxisNodes.set(id, [node, gestureRecognizer]);\n  }\n\n  deleteVerticalAxis(id) {\n    const [, gestureRecognizer] =  this._verticalAxisNodes.get(id);\n    gestureRecognizer.destroy();\n    this._verticalAxisNodes.delete(id);\n  }\n\n  createHorizontalAxis(id, node) {\n    const gestureRecognizer = new Hammer(node);\n    gestureRecognizer.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL });\n    gestureRecognizer.on('panmove', e => {\n      this.axis(id).setState(e.deltaX);\n    });\n    gestureRecognizer.on('panend', e => {\n      this.axis(id).setState(0);\n    });\n    this._horizontalAxisNodes.set(id, [node, gestureRecognizer]);\n  }\n\n  deleteHorizontalAxis(id) {\n    const [, gestureRecognizer] =  this._horizontalAxisNodes.get(id);\n    gestureRecognizer.destroy();\n    this._horizontalAxisNodes.delete(id);\n  }\n\n\n\n\n}\n\nclass InputStack extends EventProtocol {\n\n  constructor() {\n\n    super();\n\n    this.items = new Map();\n    this.reference = new Map();\n    this.addHandlers = new Map();\n    this.removeHandlers = new Map();\n\n  }\n\n  setItem(item, value) {\n\n    const itemIsNotAlreadyPresent = !this.items.has(item);\n    const valueHasChanged = (this.items.get(item) !== value);\n    const changeOccurring = itemIsNotAlreadyPresent || valueHasChanged;\n\n    this.items.set(item, value);\n\n    if(changeOccurring) {\n      this.callAddItemHandlers(item);\n      this.execListeners('change');\n    }\n\n  }\n\n  clearItem(item) {\n\n    const changeOccurring = this.items.has(item); // if item not already removed\n    this.items.delete(item);\n\n    if(changeOccurring) {\n      this.callRemoveItemHandlers(item);\n      this.execListeners('change');\n    }\n\n  }\n\n  onadd(item, handler) {\n\n    let handlersForItem = this.addHandlers.get(item);\n    if(!handlersForItem) handlersForItem = new Set();\n    handlersForItem.add(handler);\n    this.addHandlers.set(item, handlersForItem);\n\n  }\n\n  onremove(item, handler) {\n\n    let handlersForItem = this.removeHandlers.get(item);\n    if(!handlersForItem) handlersForItem = new Set();\n    handlersForItem.add(handler);\n    this.removeHandlers.set(item, handlersForItem);\n\n  }\n\n  addItemWhen(item, expectingHandler, valueInterpreter = a => a) {\n\n    expectingHandler((value = 1) => {\n\n      this.setItem(item, valueInterpreter(value));\n\n    })\n\n  }\n\n  removeItemWhen(item, expectingHandler) {\n\n    expectingHandler(() => {\n\n      this.clearItem(item);\n\n    })\n\n  }\n\n  callAddItemHandlers(item) {\n\n    let handlersForItem = this.addHandlers.get(item);\n    if(!handlersForItem) return;\n    const itemValue = this.items.get(item);\n    for(let handler of handlersForItem)\n      handler(itemValue);\n\n  }\n\n  callRemoveItemHandlers(item) {\n\n    let handlersForItem = this.removeHandlers.get(item);\n    if(!handlersForItem) return;\n    for(let handler of handlersForItem)\n      handler();\n\n  }\n\n  removeItemHandler(item, handler) {\n    const addHandlers = this.addHandlers(item);\n    if(addHandlers) addHandlers.delete(handler);\n    const removeHandlers = this.removeHandlers(item);\n    if(removeHandlers) removeHandlers.delete(handler);\n  }\n\n  clearItemHandlers(item) {\n\n    this.addHandlers.delete(item);\n    this.removeHandlers.delete(item);\n\n  }\n\n  // this.execListeners('serverUpdate', {rank, money, simple_rank, simple_money});\n\n  toString() {\n    return this.items.toString();\n  }\n\n}\n\n\n\n// var keyboard = new KeyboardInput();\n// var gamepad = new GamepadInput();\n//\n// var stack = new InputStack();\n//\n// stack.addItemWhen('shoot', keyboard.button(32).ontrue);\n// stack.removeItemWhen('shoot', keyboard.button(32).onfalse);\n//\n// stack.addItemWhen('left', gamepad.axis(0).onlessthan(-0.2));\n// stack.removeItemWhen('left', gamepad.axis(0).onmorethan(-0.2));\n// stack.addItemWhen('right', gamepad.axis(0).onmorethan(0.2));\n// stack.removeItemWhen('right', gamepad.axis(0).onlessthan(0.2));\n//\n// stack.onadd('shoot', () => console.log('shoot added'));\n// stack.onremove('shoot', () => console.log('shoot removed'));\n//\n// stack.onadd('left', () => console.log('left added'));\n// stack.onremove('left', () => console.log('left removed'));\n//\n// stack.onadd('right', () => console.log('right added'));\n// stack.onremove('right', () => console.log('right removed'));\n\n\n(() => {\n  //\n  // const handler = () => {};\n  // const interpreter = ()=>{};\n  //\n  //\n  // Keyboard.button(17).ontrue(handler);\n  // Gamepad.axis(2).onmorethan(0.2, handler);\n  // Gamepad.axis(0).onlessthan(0.2, handler);\n  //\n  // InputM.listAction(Gamepad.axis(2).onmorethan(-0.7), 'shoot');\n  // InputM.listAction(Gamepad.axis(1).onmorethan(0.2), 'x+', interpreter)\n  //\n  //\n  // Stack.enlist('shoot', Keyboard.button(3))\n\n\n\n\n  //\n  //\n  // let raw_acc_data = [0, 0], applied_acc_data = [0, 0]; // [x, y]\n  // let threshold = 1, bias = [0, 0]; // deadzone\n  // const minThreshhold = 1;\n  // const maxThreshhold = 4;\n  // const thresholdSpan = maxThreshhold - minThreshhold;\n  // bias = ENV.storage.calibration = (ENV.storage.calibration) ? ENV.storage.calibration.split(\",\").map(Number) : [0, 0];\n  // // let origin = [0, bias];\n  // if (ENV.mobile && window.DeviceMotionEvent != undefined) {\n  //   window.ondevicemotion = function (e) {\n  //     raw_acc_data = [e.accelerationIncludingGravity.x, e.accelerationIncludingGravity.y];\n  //     // if ( e.rotationRate )  {\n  //     //   document.getElementById(\"rotationAlpha\").innerHTML = e.rotationRate.alpha;\n  //     //   document.getElementById(\"rotationBeta\").innerHTML = e.rotationRate.beta;\n  //     //   document.getElementById(\"rotationGamma\").innerHTML = e.rotationRate.gamma;\n  //     // }\n  //   }\n  //\n  //   inputs.updateMotion = function () {\n  //\n  //     // generate the data\n  //\n  //     let orientation = window.orientation,\n  //       [raw_x, raw_y] = raw_acc_data, [x, y] = [raw_x, raw_y];\n  //\n  //     if (orientation === 90) {\n  //       x = -raw_y, y = raw_x\n  //     }\n  //     else if (orientation === -90) {\n  //       x = raw_y, y = -raw_x\n  //     }\n  //     else if (orientation === 180 || orientation === -180) {\n  //       x = -x, y = -y\n  //     }\n  //\n  //     applied_acc_data = [x, y];\n  //     x -= bias[0]; // bias towards player;\n  //     y -= bias[1];\n  //\n  //     if(ENV.options.input.invertControls) { x = -x; y = -y }\n  //\n  //     // apply the data\n  //\n  //\n  //     if(x > minThreshhold) { // more\n  //       if(x < maxThreshhold) inputs.angularAcceleration = (maxThreshhold - x) / thresholdSpan;\n  //       else inputs.angularAcceleration = 1;\n  //     } else if(x < -minThreshhold) { // less\n  //       if(x > -maxThreshhold) inputs.angularAcceleration = (-maxThreshhold - x) / thresholdSpan;\n  //       else inputs.angularAcceleration = -1;\n  //     } else { // neither\n  //       inputs.angularAcceleration = 0;\n  //     }\n  //\n  //     if(y > minThreshhold) { // more\n  //       if(y < maxThreshhold) inputs.acceleration = (maxThreshhold - y) / thresholdSpan;\n  //       else inputs.acceleration = 1;\n  //     } else if(y < -minThreshhold) { // less\n  //       if(y > -maxThreshhold) inputs.acceleration = (-maxThreshhold - y) / thresholdSpan;\n  //       else inputs.acceleration = -1;\n  //     } else { // neither\n  //       inputs.acceleration = 0;\n  //     }\n  //\n  //     // if (x > threshold) {\n  //     //   inputStack.add('rt')\n  //     // } else {\n  //     //   inputStack.delete('rt')\n  //     // }\n  //     // if (x < -threshold) {\n  //     //   inputStack.add('lt')\n  //     // } else {\n  //     //   inputStack.delete('lt')\n  //     // }\n  //     // if (y > threshold) {\n  //     //   inputStack.add('up')\n  //     // } else {\n  //     //   inputStack.delete('up')\n  //     // }\n  //     // if (y < -threshold) {\n  //     //   inputStack.add('dn')\n  //     // } else {\n  //     //   inputStack.delete('dn')\n  //     // }\n  //\n  //     $('#clock').text(`x: ${x.round(0)}, y: ${y.round(0)}`);\n  //\n  //   };\n  // }\n  //\n\n\n\n\n\n\n})();"]}