{"version":3,"sources":["../js/ship.js"],"names":["BasicShip","player","owner","disabled","position","V2D","velocity","acceleration","angle","health","radius","stealth","Object","assign","Ship","baseStats","type","spawn","new","team","game","mapInfo","teams","length","number","add","DeepSpaceGame","spawn_structure","players","indexOf","last_known_position","reset","dt","inert","mul_","mul","Math","pow","LINEAR_FRICTION","limit","LINEAR_VELOCITY_LIMIT","flag","drag","charging","LINEAR_VELOCITY_LIMIT_EXTENDED","data","set","undefined","energy","block_friction","shoot_angle","bullets","Set","blocks","subs","intersecting","recoil_counter","respawn_counter","regen_counter","block_recoil_counter","sub_recoil_counter","SUB_RECOIL_DELAY","flag_recoil_counter","FLAG_RECOIL_DELAY","hp","HP_CAPACITY","c","charge","IDLE_ENERGY_REGEN_RATE","ACTIVE_ENERGY_REGEN_RATE","REGEN_DELAY","heal","REGEN_RATE","RESPAWN_DELAY","ATTACK_RECOIL_DELAY","drain","ATTACK_HP","ATTACK_ENERGY_FRACTION_HP","id","NetworkHelper","bullet_create","BLOCK_RECOIL_DELAY","BLOCK_ENERGY_COST","size","BLOCK_CAPACITY","block_destroy","draw","block_create","SUB_CAPACITY","SUB_ENERGY_COST","sub_create","ENERGY_CAPACITY","out_ship_override","export_override","out_flag_pickup","percent","fwp","copy","shift","bwp","PI","SUB_TYPE","ATTACK_RADIUS","ATTACK_SPREAD","ATTACK_LIFESPAN","ATTACK_SPEED","LINEAR_ACCELERATION_LIMIT","BLOCK_HP_CAPACITY","BLOCK_SPREAD"],"mappings":"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","file":"ship.js","sourcesContent":["\nclass BasicShip {\n\n  constructor(player) {\n    this.owner = player;\n\n    this.disabled = false;\n    this.position = new V2D(20, 20);\n        this.velocity = new V2D();\n        this.acceleration = new V2D();\n    this.angle = 0;\n        // this.angular_velocity = 0;\n        // this.angular_acceleration = 0;\n    this.health = 1;\n    this.radius = 10;\n    this.stealth = false;\n\n    Object.assign(this, Ship.baseStats);           // write base stats\n    Object.assign(this, Ship.type[player.type]);   // then overwrite with type specific changes\n\n    this.spawn =\n      V2D.new(this.owner.team.game.mapInfo.spawn[this.owner.team.game.teams.length-1][this.owner.team.number])\n      .add(DeepSpaceGame.spawn_structure[this.owner.team.players.length - 1][this.owner.team.players.indexOf(this.owner)]);\n    this.last_known_position = this.position;\n    this.reset()\n  }\n\n  update(dt) {\n    if(!this.disabled) {\n      let inert = this.acceleration.length == 0 ;\n      !inert ? this.velocity.add(this.acceleration.mul_(60*dt)) : this.velocity.mul(Math.pow(this.LINEAR_FRICTION, (60*dt)) ); // TODO revise\n\n      // if(this.flag) this.velocity.mul(this.flag.drag);\n\n      let limit = this.LINEAR_VELOCITY_LIMIT; if(this.flag) limit *= this.flag.drag; if(this.charging) limit += this.LINEAR_VELOCITY_LIMIT_EXTENDED;\n      if(this.velocity.length > limit)\n         this.velocity.length = limit;\n\n      this.position.add(this.velocity.mul_(dt));\n\n      this.charging = false;\n\n      // this.angular_velocity += this.angular_acceleration\n      // this.angular_velocity *= this.ANGULAR_FRICTION - ((this.flag) ? this.flag.drag : 0)\n      // this.angle += this.angular_velocity\n      //\n      // if(this.angular_velocity > this.ANGULAR_VELOCITY_LIMIT)\n      //    this.angular_velocity = this.ANGULAR_VELOCITY_LIMIT;\n      // if(this.angular_velocity <-this.ANGULAR_VELOCITY_LIMIT)\n      //    this.angular_velocity =-this.ANGULAR_VELOCITY_LIMIT;\n    }\n  }\n\n  // adjusts forces letting the simulation continue\n  apply(data) {\n    this.disabled = data.disabled;\n    this.acceleration.set(data.acceleration);\n    // this.angular_acceleration = data.angular_acceleration;\n    this.angle = data.angle;\n    this.health = data.health;\n  }\n  // replaces the state of the ship\n  override(data) {\n    this.position.set(data.position);\n    this.last_known_position.set(data.position);\n    // this.angle = data.angle;\n  }\n\n  // update(data) {\n  //   this.disabled = data.disabled;\n  //   this.position = data.position;\n  //   this.angle = data.angle;\n  //   this.health = data.health;\n  // }\n\n  reset() {\n    this.position.set(this.spawn);\n    this.velocity.reset()\n    this.health = 1;\n    this.disabled = false;\n  }\n\n  setFlag(flag) { this.flag = flag }\n  clearFlag() { this.flag = undefined }\n}\n\nclass Ship extends BasicShip {\n\n  constructor(player) {\n    super(player);\n\n    // this._angle = 0;\n\n    this.energy = 100;\n\n    this.block_friction = 0;\n\n    this.shoot_angle = 0;\n\n    this.bullets = new Set();\n    this.blocks = new Set();\n    this.subs = new Set();\n\n    this.intersecting = new Set();\n\n    this.recoil_counter = 0;\n    this.respawn_counter = 0;\n    this.regen_counter = 0;\n    this.block_recoil_counter = 0;\n    this.sub_recoil_counter = this.SUB_RECOIL_DELAY;\n    this.flag_recoil_counter = this.FLAG_RECOIL_DELAY;\n\n    // Object.assign(this, Ship.type[player.type]); >> moved to super!\n    this.hp = this.HP_CAPACITY;\n\n    // this.spawn =\n    //   V2D.new(DeepSpaceGame.maps[0].spawn[this.owner.team.game.teams.length][this.owner.team.number])\n    //   .add(DeepSpaceGame.spawn_structure[this.owner.team.players.length - 1][this.owner.team.players.indexOf(this.owner)]);\n    // this.reset()\n  }\n\n  // export() {\n  //   return {\n  //     disabled: this.disabled,\n  //     position: this.position,\n  //     angle: this.angle,\n  //     health: this.health\n  //   }\n  // }\n\n  export_update() {\n    return {\n      disabled: this.disabled,\n      acceleration: this.acceleration,\n      // angular_acceleration: this.angular_acceleration,\n      angle: this.angle,\n      health: this.health\n    }\n  }\n\n  export_override() {\n    return {\n      position: this.position//,\n      // angle: this.angle\n    }\n  }\n\n  // get angle() { return this._angle }\n  // set angle(angle) { if(this._angle != angle) this.recoil_counter = this.ATTACK_RECOIL_DELAY; this._angle = angle; }\n\n  get health() { return this.hp / this.HP_CAPACITY }\n  set health(percent) { this.hp = percent * this.HP_CAPACITY }\n\n  get shoot_position() { var fwp = this.position.copy(); var shift = new V2D(); shift.length = 8*2; shift.angle = this.shoot_angle; fwp.add(shift); return fwp; }\n\n  get front_weapon_position() { var fwp = this.position.copy(); var shift = new V2D(); shift.length = 8*2; shift.angle = this.angle; fwp.add(shift); return fwp; }\n  get back_weapon_position() { var bwp = this.position.copy(); var shift = new V2D(); shift.length = 8*2; shift.angle = this.angle - Math.PI; bwp.add(shift); return bwp }\n\n  update(dt) {\n    let c = this.charging;\n    super.update(dt);\n    this.charging = c;\n    this.last_known_position = this.position;\n\n    if(!this.disabled) {\n      this.regen_counter+=dt;\n\n      this.charge(this.IDLE_ENERGY_REGEN_RATE*dt);\n      if(this.charging) {\n        this.charge(this.ACTIVE_ENERGY_REGEN_RATE*dt);\n        if(this.regen_counter > this.REGEN_DELAY) this.heal(this.REGEN_RATE*dt);\n      } this.charging = false;\n      // if(this.charging && !this.stealth) this.charge(this.ACTIVE_ENERGY_REGEN_RATE*dt);\n    } else {\n      if((this.respawn_counter+=dt) > this.RESPAWN_DELAY) {\n        this.respawn_counter = 0;\n        this.reset();\n      }\n    }\n    if(!this.flag) this.flag_recoil_counter+=dt;\n    this.recoil_counter+=dt; this.block_recoil_counter+=dt; this.sub_recoil_counter+=dt;\n  }\n\n  shoot() { // TODO: fix\n    if(this.recoil_counter > this.ATTACK_RECOIL_DELAY && this.drain(this.ATTACK_HP*this.ATTACK_ENERGY_FRACTION_HP)) {\n\n      var id = NetworkHelper.bullet_create(this);\n\n      this.bullets.add(id);\n      this.recoil_counter = 0;\n\n    }\n  }\n\n  damage(hp) {\n    this.hp -= hp; this.regen_counter = 0;\n    if(this.hp <= 0) this.disabled = true;\n    return this.disabled;\n  }\n\n  heal(hp) {\n    this.hp += hp;\n    if(this.hp > this.HP_CAPACITY) this.hp = this.HP_CAPACITY;\n  }\n\n  block() {\n    if(this.flag) return;\n    if(this.block_recoil_counter > this.BLOCK_RECOIL_DELAY && this.drain(this.BLOCK_ENERGY_COST)) {\n      if(this.blocks.size > this.BLOCK_CAPACITY)\n        NetworkHelper.block_destroy(this.blocks.draw());\n\n      var id = NetworkHelper.block_create(this);\n      this.blocks.add(id);\n      this.block_recoil_counter = 0;\n    }\n  }\n\n  sub() {\n    if(!(this.subs.size < this.SUB_CAPACITY || this.subs.size == 0)) return;\n    if(this.sub_recoil_counter > this.SUB_RECOIL_DELAY && this.drain(this.SUB_ENERGY_COST)) {\n      // if(!(this.subs.size > this.PULSE_CAPACITY))\n      //   NetworkHelper.out_sub_destroy(this.subs.draw());\n\n      var id = NetworkHelper.sub_create(this);\n      this.subs.add(id);\n      this.sub_recoil_counter = 0;\n    }\n  }\n\n  get subPercent() {\n    if(this.sub_recoil_counter + 1 > this.SUB_RECOIL_DELAY) { return 1; }\n    else if(this.sub_recoil_counter > 0) { return (this.sub_recoil_counter + 1) / this.SUB_RECOIL_DELAY; }\n    else { return 0; }\n  }\n\n  // adds to energy reserve\n  charge(energy) {\n    this.energy += energy;\n    if(this.energy > 100) this.energy = 100;\n  }\n\n  // takes if possible, returns a result as bool\n  drain(energy) {\n    if(this.flag) return true;\n    if(this.energy - energy < 0) return false;\n    this.energy -= energy; return true;\n  }\n\n  reset() {\n    this.position.set(this.spawn);\n    this.velocity.reset();\n    this.energy = this.ENERGY_CAPACITY;\n    this.health = 1;\n    this.disabled = false;\n    this.flag = undefined;\n    this.sub_recoil_counter = this.SUB_RECOIL_DELAY;\n\n    NetworkHelper.out_ship_override(this.export_override());\n  }\n\n  pickup(flag) {\n    if(this.flag_recoil_counter > this.FLAG_RECOIL_DELAY) {\n      NetworkHelper.out_flag_pickup(this.owner.id);\n      this.flag_recoil_counter = 0;\n      return true;\n    }\n    return false;\n  }\n\n}\n\nShip.type = {\n  \"standard\" : {\n    type: 'standard',\n\n    SUB_TYPE: 'attractor',\n    SUB_RECOIL_DELAY: 0.5, //s\n    SUB_ENERGY_COST: 45 // ep\n  },\n\n  \"rate\" : {\n    type: 'rate',\n\n    RESPAWN_DELAY: 3, // 4\n\n    ATTACK_HP: 6, // 8\n    ATTACK_RECOIL_DELAY: (1/6), // (1/4)\n    ATTACK_RADIUS: 6, // 8\n\n    // BLOCK_HP_CAPACITY: 6, // 8\n    BLOCK_RECOIL_DELAY: (1/5), // (1/6)\n\n    SUB_TYPE: 'missile',\n    SUB_RECOIL_DELAY: 1, //s 2\n    SUB_CAPACITY: 1,\n    SUB_ENERGY_COST: 70\n  },\n\n  \"speed\" : {\n    type: 'speed',\n\n    HP_CAPACITY: 18, // 20\n\n    LINEAR_VELOCITY_LIMIT: 140, // 120\n    // LINEAR_ACCELERATION_LIMIT: ,\n\n    ATTACK_HP: 7, // 8\n    ATTACK_RADIUS: 10, // 8\n    ATTACK_SPREAD: (2 * Math.PI) * (0.02), // (0.01)\n    ATTACK_LIFESPAN: 1, // 1.6\n\n    // BLOCK_RECOIL_DELAY: ,\n\n    SUB_TYPE: 'repulsor',\n    SUB_RECOIL_DELAY: 0.5, //s\n    SUB_ENERGY_COST: 30\n  },\n\n  \"defense\" : {\n    type: 'defense',\n\n    HP_CAPACITY: 32, // 20\n\n    LINEAR_VELOCITY_LIMIT: 100, // 120\n\n    ATTACK_HP: 8, // 8\n    ATTACK_RECOIL_DELAY: (1/3), // (1/4)\n    ATTACK_LIFESPAN: 1.8, // 1.6\n\n    REGEN_RATE: 10.8, // 24\n\n    BLOCK_RECOIL_DELAY: (1/6), // (1/6)\n    // BLOCK_ENERGY_COST: 10, // 8\n\n    SUB_TYPE: 'stealth_cloak',\n    SUB_RECOIL_DELAY: 1, //s\n    SUB_CAPACITY: 1,\n    SUB_ENERGY_COST: 90 // 70 when no charge upon stealth\n  },\n\n  \"damage\" : {\n    type: 'damage',\n\n    HP_CAPACITY: 22, // 20\n\n    LINEAR_VELOCITY_LIMIT: 100, // 120\n\n    ATTACK_HP: 24, // 8\n    ATTACK_RECOIL_DELAY: (1/1.2), // (1/4)\n    ATTACK_RADIUS: 12, // 8\n    ATTACK_LIFESPAN: 1.6, // 2.2\n    ATTACK_SPEED: 140, // 200\n\n    SUB_TYPE: 'block_bomb',\n    SUB_RECOIL_DELAY: 0.5, //s\n    SUB_ENERGY_COST: 50\n  }\n};\n\n// BASE STATS\n// measurements will be expressed in:\n//  time: s\n//  distance: px\n//  velocity: px / s\n//  acceleration: px / s*s\nShip.baseStats = {\n  type: 'base',\n\n  HP_CAPACITY: 20, //hp\n  // ANGULAR_FRICTION: 0.8,//0.9,\n  // ANGULAR_VELOCITY_LIMIT: 0.12,\n  // ANGULAR_ACCELERATION_LIMIT: 0.04,//0.016,\n  LINEAR_FRICTION: 0.80, //%\n  LINEAR_VELOCITY_LIMIT: 120, //188 //px/s (3px/f)\n  LINEAR_ACCELERATION_LIMIT: 10, //px/s*s (0.26px/f*f)\n  LINEAR_VELOCITY_LIMIT_EXTENDED: 50, //px/s\n\n  RESPAWN_DELAY: 4, //s (240f)\n\n  ATTACK_HP: 8, //hp\n  ATTACK_RECOIL_DELAY: 1/4, //8 //b/s (8f == 7.5b/s)\n  ATTACK_RADIUS: 8, //px\n  ATTACK_SPREAD: (2 * Math.PI) * (0.01), // (1%) angle sweep in radians,\n  ATTACK_LIFESPAN: 1.6, //0.5 //s,\n  ATTACK_ENERGY_FRACTION_HP: 0.3, //%\n  ATTACK_SPEED: 200, //px/s\n\n  REGEN_DELAY: 3, //s (180f)\n  REGEN_RATE: 24, //hp/s (0.4hp/f)\n\n  BLOCK_CAPACITY: 200, //#\n  BLOCK_HP_CAPACITY: 20, //hp\n  BLOCK_SPREAD: (2 * Math.PI) * (0.1), // 0.2 (30%) angle sweep in radians.\n  BLOCK_RECOIL_DELAY: 1/6, //b/s (8f == 7.5b/s)\n  BLOCK_ENERGY_COST: 8, //ep\n\n  SUB_TYPE: 'block_bomb',\n  SUB_RECOIL_DELAY: 0.5, //s\n  SUB_CAPACITY: 5, //#\n  SUB_ENERGY_COST: 40, //ep\n\n  ENERGY_CAPACITY: 100, // (ep)\n  IDLE_ENERGY_REGEN_RATE: 4.2, // of automatic energy per second (ep/s)\n  ACTIVE_ENERGY_REGEN_RATE: 24, // while charging energy per second (ep/s)\n\n  FLAG_RECOIL_DELAY: 1 // s\n};\n\n// SPECIALS??? LARGE HEAVY BLOCK, or INTEL\n"]}