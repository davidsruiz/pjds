{"version":3,"sources":["../js/user.js"],"names":["User","id","ENV","storage","name","user_name","rank","money","simple_rank","simple_money","stats","wins","losses","kills","deaths","simpleRankIsInvalid","resetRank","refreshUserMiniView","watch","idChangeHandler","nameChangeHandler","propChangeHandler","validateStats","listeners","Map","refreshUserNameMiniView","refreshUserRankMiniView","refreshUserMoneyMiniView","userViewsAreAvailable","no_name_small","no_name_large","node_small","document","querySelector","node_large","name_small","textContent","box_node","rank_node","rank_letter","rank_number","removeAttribute","setAttribute","money_node","refreshUserLayer","UA","refreshUI","prop","old_value","new_value","wait","resolveCallback","rejectCallback","$","ajax","url","type","data","JSON","stringify","contentType","dataType","done","simple","encoded","fail","execListeners","refreshUserViews","key","handler","listenerList","get","push","set","info","listener","indexOf","splice","Promise","resolve","reject","calculateRankLetter","calculateRankNumber","parseInt","UserAdapter","root","_root","default_name","String","Math","randomIntMinMax","padding","attempts","validation","test","swearjar","profane","trim","window","prompt","substring","name_set","user","user_set","val","text","friends","size","winRate","round","removeAttr","attr","ongoing","updateStatsAjax","click","getName","resetStats","LOBBY","showLayer","hideLayer"],"mappings":"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","file":"user.js","sourcesContent":["\nclass User {\n\n  constructor() {\n    this.id = ENV.storage.id;\n    this.name = ENV.storage.user_name;\n    this.rank = ENV.storage.rank;\n    this.money = ENV.storage.money;\n\n    this.simple_rank = ENV.storage.simple_rank; // this is a number from 0 to 599\n    this.simple_money = ENV.storage.simple_money;\n\n    this.stats = {};\n    this.stats.wins = ENV.storage.wins;\n    this.stats.losses = ENV.storage.losses;\n    this.stats.kills = ENV.storage.kills;\n    this.stats.deaths = ENV.storage.deaths;\n\n\n    const simpleRankIsInvalid = !(this.simple_rank >= 0);\n\n    if(this.id && simpleRankIsInvalid) { // if id and invalid rank, reset\n      this.resetRank();\n    } else {\n      this.refreshUserMiniView();\n    }\n\n\n\n    this.watch('id', this.idChangeHandler);\n    this.watch('name', this.nameChangeHandler);\n    this.watch('rank', this.propChangeHandler);\n    this.watch('simple_rank', this.propChangeHandler);\n    this.watch('money', this.propChangeHandler);\n    this.watch('simple_money', this.propChangeHandler);\n\n    this.stats.watch('wins', this.propChangeHandler);\n    this.stats.watch('losses', this.propChangeHandler);\n    this.stats.watch('kills', this.propChangeHandler);\n    this.stats.watch('deaths', this.propChangeHandler);\n\n    this.validateStats();\n\n    // promises\n    // this.get_id = () => {\n    //   return new Promise((resolve, reject) => {\n    //     if (this.id) {\n    //       resolve(this.id);\n    //     } else {\n    //       $.ajax({\n    //         url: '/id',\n    //         type: 'POST'\n    //       })\n    //         .done(resolve);\n    //     }\n    //   });\n    //\n    // }\n    // this.get_name = () => {\n    //   return new Promise((resolve, reject) => {\n    //     let name = this.name,\n    //         validation = name => {\n    //           // only alphanumeric and whitespace characters\n    //           if(!(/^(\\w|\\s)+$/.test(name))) return false;\n    //\n    //           // no profanity\n    //           if(swearjar.profane(name)) return false;\n    //\n    //           return true;\n    //         }\n    //\n    //     while(!name || (name.trim()===\"\") || !validation(name)) {\n    //       name = window.prompt('please enter a display name');\n    //     }\n    //\n    //     this.name = name.trim();\n    //     resolve(name);\n    //   })\n    // }\n\n    // this.get_rank =\n\n    this.listeners = new Map();\n  }\n\n  get get_rank() {\n    return (new Promise((resolve, reject) => {\n      if(this.simple_rank >= 0) {\n        resolve(this.simple_rank);\n      } else {\n        this.resetRank(resolve, reject);\n      }\n    }));\n  }\n\n  refreshUserMiniView() {\n    this.refreshUserNameMiniView();\n    this.refreshUserRankMiniView();\n    this.refreshUserMoneyMiniView();\n  }\n  refreshUserNameMiniView(name = this.name) {\n    if(!userViewsAreAvailable()) return;\n\n    const no_name_small = 'g';\n    const no_name_large = 'guest';\n    const node_small = document.querySelector('#umi_name_letter');\n    const node_large = document.querySelector('#umi_name_full');\n    const name_small = (name) ? name[0] : no_name_small;\n    if(node_small && node_large) {\n      node_small.textContent = name_small;\n      node_large.textContent = name || no_name_large\n    }\n  }\n  refreshUserRankMiniView() {\n    if(!userViewsAreAvailable()) return;\n\n    const box_node = document.querySelector('#user_mini_info');\n    const rank_node = box_node.querySelector('#umi_stats_rank');\n    if(this.name && this.simple_rank >= 0) {\n      rank_node.textContent = `${this.rank_letter} ${this.rank_number}`;\n      box_node.removeAttribute('limited');\n    } else {\n      box_node.setAttribute('limited', '');\n    }\n  }\n  refreshUserMoneyMiniView() {\n    if(!userViewsAreAvailable()) return;\n\n    const box_node = document.querySelector('#user_mini_info');\n    const money_node = box_node.querySelector('#umi_stats_currency');\n    if(this.name && this.simple_rank >= 0 && this.simple_money >= 0) {\n      money_node.textContent = this.simple_money;\n      box_node.removeAttribute('limited');\n    } else {\n      box_node.setAttribute('limited', '');\n    }\n  }\n\n  refreshUserViews() {\n    this.refreshUserMiniView();\n    this.refreshUserLayer();\n  }\n\n  refreshUserLayer() {\n    if(!userViewsAreAvailable()) return;\n    if(ENV.UA) ENV.UA.refreshUI();\n  }\n\n  get rank_letter() {\n    return User.calculateRankLetter(this.simple_rank)\n  }\n  get rank_number() {\n    return User.calculateRankNumber(this.simple_rank)\n  }\n\n  static calculateRankLetter(simple_rank) { return ['E', 'D', 'C', 'B', 'A', 'M'][parseInt(simple_rank/100)] }\n  static calculateRankNumber(simple_rank) { return simple_rank%100 }\n  static calculateRankString(simple_rank) { return `${User.calculateRankLetter(simple_rank)} ${User.calculateRankNumber(simple_rank)}` }\n\n  idChangeHandler(prop, old_value, new_value) {\n    ENV.storage.id = new_value;\n    if(old_value != new_value) this.resetRank.wait(10);\n    return new_value;\n  }\n\n  nameChangeHandler(prop, old_value, new_value) {\n    ENV.storage.user_name = new_value;\n    this.refreshUserNameMiniView(new_value);\n    return new_value;\n  }\n\n  propChangeHandler(prop, old_value, new_value) {\n    ENV.storage[prop] = new_value;\n    return new_value;\n  }\n\n  resetRank(resolveCallback = ()=>{}, rejectCallback = ()=>{}) {\n    $.ajax({\n      url: '/rank',\n      type: 'POST',\n      data: JSON.stringify({ id: this.id }),\n      contentType: 'application/json; charset=utf-8',\n      dataType: 'json'\n    })\n    .done(( data ) => {\n      var {simple, encoded} = data;\n      this.simple_rank = simple;\n      this.rank = encoded;\n\n      resolveCallback(simple);\n      // this.refreshUserRankMiniView();\n    })\n    .fail(() => {\n      rejectCallback();\n    });\n  }\n\n  updateRank() {\n    $.ajax({\n      url: '/update_rank',\n      type: 'POST',\n      data: JSON.stringify({ rank: this.rank, id: this.id }),\n      // data: JSON.stringify({ history: pp }),\n      contentType: 'application/json; charset=utf-8',\n      dataType: 'json'\n    })\n    .done(( data ) => {\n      var {simple, encoded} = data;\n      this.simple_rank = simple;\n      this.rank = encoded;\n\n      this.refreshUserRankMiniView();\n    });\n  }\n\n  updateStatsAjax() {\n    $.ajax({\n      url: '/update_stats',\n      type: 'POST',\n      data: JSON.stringify(\n        [\n          this.id,\n          this.rank,\n          this.money,\n        ]\n      ),\n      contentType: 'application/json; charset=utf-8',\n      dataType: 'json'\n    })\n      .done(([rank, money, simple_rank, simple_money]) => {\n\n        this.rank = rank;\n        this.money = money;\n        this.simple_rank = simple_rank;\n        this.simple_money = simple_money;\n\n        this.execListeners('serverUpdate', {rank, money, simple_rank, simple_money});\n\n        this.refreshUserViews();\n      });\n  }\n\n\n  validateStats() {\n    if(!(this.stats.wins >= 0)) this.stats.wins = 0;\n    if(!(this.stats.losses >= 0)) this.stats.losses = 0;\n    if(!(this.stats.kills >= 0)) this.stats.kills = 0;\n    if(!(this.stats.deaths >= 0)) this.stats.deaths = 0;\n  }\n\n  resetStats() {\n    this.stats.wins = 0;\n    this.stats.losses = 0;\n    this.stats.kills = 0;\n    this.stats.deaths = 0;\n  }\n\n  // Listeners\n  addListener(key, handler) {\n\n    if(typeof handler !== 'function')\n      return false;\n\n    const listenerList = this.listeners.get(key) || [];\n    listenerList.push(handler);\n    this.listeners.set(key, listenerList);\n\n    return true; // success\n\n  }\n\n  execListeners(key, info) {\n    const listenerList = this.listeners.get(key) || [];\n    for(let listener of listenerList)\n      listener(info);\n  }\n\n  removeListener(key, handler) {\n    const listenerList = this.listeners.get(key) || [];\n    const indexOf = listenerList.indexOf(handler);\n    if(indexOf === -1) return false; // failure\n    listenerList.splice(indexOf, 1);\n    return true; // success\n  }\n\n}\n\nclass UserAdapter {\n\n  constructor(root) {\n    this._root = root;\n\n  }\n\n  getName() {\n    let name,\n        default_name = 'user' + String(Math.randomIntMinMax(10, 10000)).padding(4, '0'),\n        attempts = 0,\n        validation = name => {\n          // only alphanumeric and whitespace characters\n          if(!(/^(\\w|\\s)+$/.test(name))) return false;\n\n          // no profanity\n          if(swearjar.profane(name)) return false;\n\n          return true;\n        };\n\n    while(!name || (name.trim()===\"\") || !validation(name)) {\n      if(++attempts > 3) { name = default_name }\n      else { name = window.prompt('please enter a display name' + (attempts-1 ? ` (letters and numbers only please)` : ''), this._root.name || ''); }\n    }\n\n    name = name.trim().substring(0, 10);\n\n    this._root.name = name;\n    this.refreshUI();\n\n    return name;\n  }\n\n  refreshUI() {\n    // mini user info\n    // mini user info end\n\n    // user info content\n    const name_set = !!ENV.user.name;\n    const user_set = name_set && !!ENV.user.rank;\n\n    //name\n    $('#uic_title').val(ENV.user.name || '_name_');\n    // edit button\n    $('#uic_title_edit').text(name_set ? 'change' : 'set');\n\n    if(user_set) {\n\n      const friends = ENV.friends ? ENV.friends.friends.size : 0;\n      const wins = ENV.user.stats.wins || 0;\n      const losses = ENV.user.stats.losses || 0;\n      const kills = ENV.user.stats.kills || 0;\n      const deaths = ENV.user.stats.deaths || 0;\n      let winRate = (wins/losses || 0).round(1);\n      if(winRate > 10) winRate = '10+';\n\n      $('#uic_money_cell').text(ENV.user.simple_money);\n      $('#uic_rank_cell').text(ENV.user.rank_letter + ' - ' + ENV.user.rank_number);\n      $('#uic_win_cell').text(winRate);\n      $('#uic_friends_cell').text(friends);\n\n      $('#uic_wins_row').text(wins);\n      $('#uic_losses_row').text(losses);\n      $('#uic_kills_row').text(kills);\n      $('#uic_deaths_row').text(deaths);\n\n      $('#uic_reset_button').removeAttr('disabled');\n    } else {\n      $('#uic_money_cell').text('-');\n      $('#uic_rank_cell').text('-');\n      $('#uic_win_cell').text('-');\n      $('#uic_friends_cell').text('-');\n\n      $('#uic_wins_row').text('-');\n      $('#uic_losses_row').text('-');\n      $('#uic_kills_row').text('-');\n      $('#uic_deaths_row').text('-');\n\n      $('#uic_reset_button').attr('disabled', 'true')\n    }\n\n\n\n  }\n\n}\n\nconst userViewsAreAvailable = () => document.querySelector('#user_mini_info');\n\n$(()=>{\n\n  ENV.user = new User();\n  if(ENV.storage.ongoing == 'true') { ENV.user.updateStatsAjax(); ENV.storage.ongoing = 'false' }\n\n  if(userViewsAreAvailable()) { // revise ... make user always accessible with its view components optional\n\n    ENV.UA = new UserAdapter(ENV.user);\n    $('#uic_title_edit').click(jqEvent => { ENV.UA.getName() });\n    $('#uic_reset_button').click(jqEvent => { ENV.user.resetStats(); ENV.UA.refreshUI(); })\n    ENV.UA.refreshUI();\n\n\n    $('#user_mini_info').click(jqEvent => { ENV.UA.refreshUI(); LOBBY.showLayer('#user_info_layer') });\n    $('#user_info_background, #uic_close_button').click(jqEvent => { LOBBY.hideLayer('#user_info_layer') })\n\n  }\n\n});"]}