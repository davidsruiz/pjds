{"version":3,"sources":["../js/deepspace.js"],"names":["DeepSpaceGame","data","network","interpret","setup","loop","timer","start","timerExpire","spectate","ENV","isHost","host","mapInfo","maps","options","map","gameMode","mode","game","language","Timer","duration","TIME","sec","TINT","load","colors","e","log","setupData","setupPhysics","setupModel","setupView","setupListeners","setupLoop","setupReferences","setupTeams","setupPlayers","setupShips","setupObjectPools","setupGame","setupMap","teams","teamCount","length","times","i","push","Team","setupSpawnCamps","forEach","team","spawn_camp","position","V2D","new","spawn","number","radius","players","Map","playerIndex","id","name","type","createPlayer","ships","player","ship","localIDMatches","Ship","isMain","main","BasicShip","model","bullets","blocks","subs","disabled","ended","overtime","scores","Array","centerX","width","centerY","height","flag","Flag","collision_groups","physics","FLAG","setCollisionDivisions","fill","max","Physics","distance","x","y","lead","undefined","info","cX","cY","initial_impermeables","radii","Set","impermeables","bodies","radius_size_group","list","slice","shift","add","copies","obj","imp","IMPERMEABLES","setupPalette","configureCreateJS","setupCamera","setupCanvas","createViews","canvas","$","document","body","clientWidth","clientHeight","scale","Math","sqrt","stage","createjs","Stage","snapToPixel","HDPSupport","HDPScale","window","devicePixelRatio","getAttribute","setAttribute","round","style","scaleX","scaleY","view","createLayers","createBackgroundViews","createGameModeSpecificViewsAction","createSpawnCampViews","createShipViews","createPoolViews","createOverlayViews","layer","background","Container","action","overlay","back","front","addChild","canvasBackground","Shape","mapBackground","graphics","beginFill","drawRect","cache","background_width","background_height","hypotenuse","sqr","regX","regY","map_background","caches","block_fill","r","s","set","cacheCanvas","Bitmap","get","block","pos","group","camp","color","spawn_camp_fill","alpha","our_ship","our_team","owner","container","hollow","filled","text","Text","textAlign","innerRadius","outerRadius","meter","energyMeter","shadow","energyMeterShadow","offset","meter_shadow","score","imagined_width","toString","createOverlayMinimapViews","message","kill_message","modes","flag_radius","flag_shadow","overlay_model","overlay_view","mini","minimap","rotation","degrees","spawnRotation","padd","circle_fill","flag_view","this_player","this_team","graphicsCaches","blv","setChildIndex","camera","Camera","activePlayerIndex","activePlayers","p","updateCameraFocus","focus","inputHandlers","receiver","keyHandler","keyCode","addEventListener","inputStack","input","changed","keymap","eventCode","row","code","is","has","delete","gamepad","updateGamepadInput","navigator","getGamepads","deadZone","buttonMap","axes","buttons","pressed","bindings","activation","_","contains","raw_acc_data","applied_acc_data","threshold","bias","storage","calibration","split","Number","mobile","DeviceMotionEvent","ondevicemotion","accelerationIncludingGravity","updateMotion","orientation","raw_x","raw_y","left","querySelector","joystick","joystick_deadzone_radius","right","right_hammer","Hammer","on","v","deltaX","deltaY","a","angle","hammertime","taps","direction","DIRECTION_LEFT","ev","wait","setupCollisionSystem","assignCollisionPatterns","setupReferenceGroups","block_size","world_size","rows","ceil","cols","divisions","division_index","division_coordinates","floor","collision_checks","SHIPS","Symbol","OUR_SHIP","OUR_SHIPS","ENEMY_SHIPS","BULLETS","MY_BULLETS","OUR_BULLETS","ENEMY_BULLETS","BLOCKS","OUR_BLOCKS","ENEMY_BLOCKS","OUR_PROJ_SUBS","SPAWN_CAMPS","OUR_SPAWN_CAMP","ENEMY_SPAWN_CAMPS","REFUGE","OUR_REFUGE","Object","keys","physics_body","clearCollisionDivisions","check_x","unit_offset_array","check_y","division_x","division_y","d","checks","groups","bullet","damageShip","hp","creator","removeBullet","damageBlock","idle","canPickupFlag","assumeFlag","sub","explode","removeSub","block_a","block_b","overlap","removeBlock","refuge","bounce","charging","refGroups","enemyBlocks","enemySubs","animate","FPS","n","getAnimationFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","setupDT","last_time","Date","getTime","dt","now","setupShortcutsToCommonCalls","setupFinishCollisionAssignment","setupGraphicsCaches","enemyTeams","filter","enemyPlayers","reduce","concat","spawn_c","setupCommonGraphicsCachePool","gc","Bullet","stats","MAX_RADIUS","particle","unlocked","locked","enemy","Block","border","block_border","c","COLOR","mix","updateDT","update","over","updateInput","updateModel","checkForCollisions","updateGame","updateView","updateShips","broadcastShip","updateBullets","updateBlocks","updateSubs","x2","y2","prop","releaseFlag","canSub","addSub","canBlock","reachedBlockLimit","oldestBlockID","addBlock","direction_v","relative_shoot_angle","PI","acceleration","LINEAR_ACCELERATION_LIMIT","angular_acceleration","ANGULAR_ACCELERATION_LIMIT","canShoot","addBullet","velocity","sendShipUpdate","export_update","sendShipOverride","export_override","b","qualified","createOverlayMinimapBlockViewFor","RANGE","force","copy","INTENSITY_FUNCTION","exploding","EXPLOSION_RANGE","EXPLOSION_DAMAGE_FUNCTION","destroySub","target","VISION_RANGE","stealth","changeBlock","div","a_type","b_type","check","body_a","body_b","doTouch","holderID","last_known_position","percent","low_score","current_score","sendFlagProgress","alert","localizationStrings","alerts","updateShipViews","updateBulletViews","updateBlockViews","updateSubViews","updateCamera","updateBackground","updateMap","updateTINT","updateGameViews","updateMinimapView","visible","showing","visibility","flipCoin","ship_view","health","image","updateEnergyMeterView","updateNameViews","meterView","shadowView","energy","textView","views","isForeign","map_width","map_height","half_window_width","half_window_height","half_background_width","half_background_height","backgroundPositionVector","centerOffset","radians","setAngleOffset","GRID","calculateTeamScoreAppearance","updateFlagView","indexOf","bestScore","each","not_visible","newPosition","plane","mul","padding","resetInput","deinitListeners","cancel","LOBBY","disconnect","results","disableInteraction","toID","fromID","adjustShipHP","sendAdjustShipHP","damage","processDeath","deathOccurrence","sendDeathOccurrence","t","g","deaths","kills","alert_kill","animateFocus","generateBulletData","createBullet","sendCreateBullet","didShoot","uuid","shoot_position","shoot_angle","shot_RNG","ATTACK_RADIUS","ATTACK_HP","lifespan","ATTACK_LIFESPAN","speed","ATTACK_SPEED","bv","destroyBullet","sendDestroyBullet","removeChild","generateBlockData","createBlock","sendCreateBlock","didBlock","front_weapon_position","BLOCK_SPREAD","random","BLOCK_HP_CAPACITY","randomIntMinMax","MIN_SPEED","MAX_SPEED","bl","adjustBlockHP","sendAdjustBlockHP","setBlockTeam","sendSetBlockTeam","oldTeam","destroyBlock","sendDestroyBlock","generateSubData","createSub","sendCreateSub","didSub","SUB_TYPE","Attractor","Repulsor","BlockBomb","StealthCloak","Missile","pv","sendDestroySub","captureFlag","sendCaptureFlag","didPickupFlag","setFlag","us","dropFlag","sendDropFlag","clearFlag","reset","msg","clearTimeout","alertTimeout","trim","alertKillTimeout","takerID","giverID","deinitCaches","deinitPhysics","deinitInput","deinitCamera","deinitView","deinitGame","deinitModel","runningInstance","handler","removeEventListener","removeAllChildren","clear","disconnected","deinit","size","Graphics","drawCircle","beginStroke","setStrokeStyle","moveTo","lineTo","block_center","attractor","repulsor","block_bomb","arcTo","missile","ring","Shadow","arc","renderingParameters","enemyTakesFlag","en","teamTakesFlag","enemyDropsFlag","teamDropsFlag","yourKill","yourDeath","teamTakesLead","teamLosesLead","spawn_structure","ctf","ring_radius","time_limit","FRAMES","mins"],"mappings":"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","file":"deepspace.js","sourcesContent":["// deep space js by david ruiz.\n\n\nclass DeepSpaceGame {\n\n  // at initialization we can assume the environment\n  // knows certain game parameters:\n  // - map\n  // - game mode\n  // - players: amount, names, ship types, indexes,\n  constructor(data, network) {\n    this.interpret(data, network);\n    this.setup();\n    // this.loop();\n  }\n\n  static create(data, network) {\n    if (DeepSpaceGame.runningInstance) DeepSpaceGame.runningInstance.deinit();\n    return DeepSpaceGame.runningInstance = new DeepSpaceGame(data, network);\n  }\n\n  start() {\n    this.loop();\n    this.timer.start(() => {\n      this.timerExpire()\n    });\n  }\n\n  interpret(data, network) {\n    // anything pertaining to game\n    // object itself gets set\n    this.spectate = ENV.spectate;\n    this.isHost = data.host;\n    this.mapInfo = DeepSpaceGame.maps[data.options.map];\n    this.gameMode = data.options.mode;\n    this.game = {}\n    this.language = 'en';\n    this.timer = new Timer(data.duration - TIME.sec(1.5));\n\n    this.network = network;\n    this.network.game = this;\n\n\n    // SoundHelper.start(); // new\n    // this.soundHelper = SoundHelper.start(); // olc\n\n    try {\n      if (TINT) TINT.load(...data.colors[1])\n    } catch (e) {\n      log('tint load failed')\n    }\n\n    // everything else:\n    this.setupData = data;\n  }\n\n  setup() {\n    this.setupPhysics();\n    this.setupModel();\n    this.setupView();\n    this.setupListeners();\n    this.setupLoop();\n    this.setupReferences();\n\n    // if (this.spectate) this.actualize();\n  }\n\n  setupModel() {\n    this.setupTeams();\n    this.setupPlayers();\n    this.setupShips();\n    this.setupObjectPools();\n\n    this.setupGame();\n    this.setupMap();\n  }\n\n  setupTeams() {\n    this.teams = [];\n    let teamCount = this.setupData.teams.length;\n    teamCount.times((i) => {\n      this.teams.push(new Team(this, i))\n    });\n\n    this.setupSpawnCamps();\n  }\n\n  setupSpawnCamps() {\n    this.teams.forEach(team => {\n      team.spawn_camp = {\n        position: V2D.new(this.mapInfo.spawn[team.game.teams.length - 1][team.number]),\n        radius: 64,\n        team: team.number\n      }\n    });\n  }\n\n  setupPlayers() {\n    this.players = new Map();\n    this.teams.forEach((team, i) => {\n      this.setupData.teams[i].forEach((playerIndex)=>{\n        var [id, name, , , , type] = this.setupData.players[playerIndex];\n        team.createPlayer(id, name, type);\n      });\n    });\n  }\n\n  setupShips() {\n    this.ships = [];\n    this.players.forEach((player) => {\n      var ship;\n      if (localIDMatches(player.id) && !this.spectate) {\n        ship = new Ship(player);\n        ship.isMain = true;\n        this.ships.main = ship;\n      } else {\n        ship = new BasicShip(player);\n      }\n      this.ships.push(ship);\n      player.ship = ship;\n    });\n  }\n\n  setupObjectPools() {\n    var model = {};\n    model.bullets = new Map();\n    model.blocks = new Map();\n    model.subs = new Map();\n\n    this.model = model;\n  }\n\n  setupGame() {\n    this.game = {};\n    this.game.disabled = false; // interaction disabled\n    this.game.ended = false; // game over happened\n    this.game.overtime = false; // game overtime happened\n\n    this.game.scores = new Array(this.teams.length);\n\n    // this.timer = DeepSpaceGame.modes[this.gameMode];\n    switch (this.gameMode) {\n      case 0: // ctf\n\n        // flag whatevers\n        var centerX = this.mapInfo.width / 2;\n        var centerY = this.mapInfo.height / 2;\n        let flag = new Flag(new V2D(centerX, centerY));\n        flag.collision_groups = [this.physics.collision_groups.FLAG];\n        this.setCollisionDivisions(flag);\n        this.game.flag = flag;\n\n        // actual game stats\n        this.game.scores.fill(100);\n        this.game.max = Physics.distance(this.teams[0].spawn_camp.position, {x: centerX, y: centerY});\n        this.game.lead = undefined; // team in the lead\n\n        break;\n\n      case 1:\n\n        this.game.scores.fill(0);\n\n        break;\n    }\n  }\n\n  setupMap() {\n    let map = this.model.map = {},\n      info = this.mapInfo;\n\n    let cX = info.width / 2,\n      cY = info.height / 2;\n\n\n    // IMPERMEABLES\n    let initial_impermeables = [], radii = new Set();\n    for (let radius_size_group of info.impermeables.bodies) {\n      let list = radius_size_group.slice(),\n        radius = list.shift();\n      for (let [x, y] of list) {\n        initial_impermeables.push({\n          radius: radius,\n          position: {x, y}\n        })\n      }\n      radii.add(radius);\n    }\n\n    map.impermeables = [];\n    map.impermeables.radii = radii;\n    // in the future use the 'copies' variable on impermeables\n    // and make it odd symmetry\n    map.impermeables.push(...initial_impermeables)\n    if (info.impermeables.copies >= 2) {\n\n      map.impermeables.push(...(initial_impermeables.map(obj => {\n        return {\n          radius: obj.radius,\n          position: {x: info.width - obj.position.x, y: info.width - obj.position.y}\n        }\n      })));\n\n      if (info.impermeables.copies == 4) {\n\n        map.impermeables.push(...(initial_impermeables.map(obj => {\n          return {\n            radius: obj.radius,\n            position: {x: info.width - obj.position.y, y: obj.position.x}\n          }\n        })));\n\n        map.impermeables.push(...(initial_impermeables.map(obj => {\n          return {\n            radius: obj.radius,\n            position: {x: obj.position.y, y: info.width - obj.position.x}\n          }\n        })));\n\n      }\n\n    }\n\n    for (let imp of map.impermeables) {\n      imp.collision_groups = [this.physics.collision_groups.IMPERMEABLES]\n      this.setCollisionDivisions(imp);\n    }\n\n  }\n\n  setupView() {\n    this.setupPalette();\n    this.configureCreateJS();\n    this.setupCamera();\n  }\n\n  setupPalette() {\n    this.colors = this.setupData.colors;\n  }\n\n  configureCreateJS() {\n    this.setupCanvas();\n    // populate stage\n    this.createViews();\n  }\n\n  setupCanvas() { // TODO: (revise)\n    var canvas = $('#canvas')[0];\n    canvas.width = document.body.clientWidth;\n    canvas.height = document.body.clientHeight;\n    // if (canvas.width > 1024) canvas.width = 1024;\n    // if (canvas.height > 768) canvas.height = 768;\n    \n    this.scale = Math.sqrt(canvas.width * canvas.height) / Math.sqrt(1024 * 768);\n    // this.scale ;\n\n    var stage = new createjs.Stage();\n    stage.canvas = canvas;\n    stage.snapToPixel = true;\n    // gui.add(stage, 'snapToPixel');\n\n    this.stage = stage;\n\n    this.HDPSupport();\n  }\n\n  HDPSupport() {\n    this.HDPScale = 1;\n    if (window.devicePixelRatio) {\n      const stage = this.stage;\n      const canvas = stage.canvas;\n\n      // grab the width and height from canvas\n      var height = canvas.getAttribute('height');\n      var width = canvas.getAttribute('width');\n      // reset the canvas width and height with window.devicePixelRatio applied\n      canvas.setAttribute('width', Math.round(width * window.devicePixelRatio));\n      canvas.setAttribute('height', Math.round( height * window.devicePixelRatio));\n      // force the canvas back to the original size using css\n      canvas.style.width = width+\"px\";\n      canvas.style.height = height+\"px\";\n      // set CreateJS to render scaled\n      stage.scaleX = stage.scaleY = window.devicePixelRatio;\n      this.HDPScale = 1/window.devicePixelRatio\n    }\n  }\n\n  createViews() {\n    this.view = {};\n    this.window = {\n      width: this.stage.canvas.width * this.HDPScale,\n      height: this.stage.canvas.height * this.HDPScale,\n    };\n\n    this.createLayers();\n    this.createBackgroundViews();\n    this.createGameModeSpecificViewsAction();\n    this.createSpawnCampViews()\n    this.createShipViews();\n    this.createPoolViews();\n    this.createOverlayViews();\n  }\n\n  createLayers() {\n    var layer = {}\n\n    layer.background = new createjs.Container();\n    layer.action = new createjs.Container();\n    layer.overlay = new createjs.Container();\n\n    layer.action.back = new createjs.Container();\n    layer.action.front = new createjs.Container();\n    layer.action.addChild(layer.action.back);\n    layer.action.addChild(layer.action.front);\n\n    layer.action.scaleX = layer.action.scaleY = this.scale;\n\n    this.stage.addChild(layer.background);\n    this.stage.addChild(layer.action);\n    this.stage.addChild(layer.overlay);\n\n    this.view.layer = layer;\n  }\n\n  createBackgroundViews() {\n    // var canvas = this.stage.canvas, background = new createjs.Shape();\n    // // background.graphics.beginFill('#37474F').drawRect(0, 0, canvas.width, canvas.height);\n    // // background.cache(0, 0, canvas.width, canvas.height);\n    // // this.view.layer.background.addChild(background);\n    // //\n    // // background = new createjs.Shape();\n    // background.graphics.beginFill('#455A64').drawRect(0, 0, canvas.width, canvas.height);\n    // background.cache(0, 0, canvas.width, canvas.height);\n    // this.view.layer.background.map_background = background;\n    // this.view.layer.background.addChild(background);\n\n\n    var canvas = this.stage.canvas, canvasBackground = new createjs.Shape(), mapBackground = new createjs.Shape();\n    canvasBackground.graphics.beginFill('#37474F').drawRect(0, 0, this.window.width, this.window.height);\n    canvasBackground.cache(0, 0, canvas.width, canvas.height);\n    this.view.layer.background.addChild(canvasBackground);\n\n    const background_width = this.window.width * 2\n    const background_height = this.window.width * 2\n    const hypotenuse = Math.sqrt(Math.sqr(this.window.width) + Math.sqr(this.window.height)) / this.scale;\n    mapBackground.graphics.beginFill('#455A64').drawRect(0, 0, hypotenuse, hypotenuse);\n    mapBackground.cache(0, 0, hypotenuse, hypotenuse);\n    mapBackground.regX = hypotenuse/2;\n    mapBackground.regY = hypotenuse/2;\n    this.view.layer.background.map_background = mapBackground;\n    this.view.layer.action.back.addChild(mapBackground);\n\n  }\n\n  createGameModeSpecificViewsAction() {\n    /*switch(this.gameMode) {\n     case \"ctf\":\n     // ring and flag\n\n     var centerX = this.mapInfo.width / 2;\n     var centerY = this.mapInfo.height / 2;\n\n     var r = DeepSpaceGame.modes[\"ctf\"].ring_radius, s = r * 1.2;\n     var ring = new createjs.Shape(\n     DeepSpaceGame.graphics.ring(r)\n     );\n     ring.cache(-s, -s, s*2, s*2);\n\n     // var r = DeepSpaceGame.modes[\"ctf\"].flag_radius, s = r * 1.2;\n     // var flag = new createjs.Shape(\n     //   DeepSpaceGame.graphics.flag(DeepSpaceGame.modes[\"ctf\"].flag_radius)\n     // );\n     // flag.shadow = DeepSpaceGame.graphics.flag_shadow();\n     // flag.cache(-s, -s, s*2, s*2);\n     //\n     ring.x = centerX; ring.y = centerY;\n     // flag.x = centerX; flag.y = centerY;\n\n\n     this.view.layer.action.back.addChild(ring);\n     // this.view.layer.action.back.addChild(flag);\n\n     // this.view.flag = flag;\n\n     // actual game things\n\n\n     break;\n     }*/\n\n    // create caches\n    var caches = new Map();\n    this.model.map.impermeables.radii.forEach(r => {\n      var view = new createjs.Shape(DeepSpaceGame.graphics.block_fill('#37474F', r));\n      var s = r * 1.2;\n      view.cache(-s, -s, s * 2, s * 2);\n\n      caches.set(r, view.cacheCanvas);\n    })\n\n    // create views\n    this.view.map = {impermeables: []}\n    this.model.map.impermeables.forEach(block => {\n      var view = new createjs.Bitmap(caches.get(block.radius)),\n        pos = block.position;\n      view.x = pos.x - block.radius * 1.2;\n      view.y = pos.y - block.radius * 1.2;\n      this.view.map.impermeables.push(view)\n      this.view.layer.action.front.addChild(view);\n    });\n\n  }\n\n  createSpawnCampViews() {\n\n    // this.view.teams = { spawn_camp: []}\n\n    // DeepSpaceGame.maps[0].spawn[this.owner.team.game.teams.length][this.owner.team.number]\n    var s = 64 + 3; // radius + border-half\n    this.teams.forEach((team, i) => {\n      var group = new createjs.Container(),\n        camp = new createjs.Shape(DeepSpaceGame.graphics.spawn_camp(team.color)),\n        fill = new createjs.Shape(DeepSpaceGame.graphics.spawn_camp_fill(team.color)),\n        pos = team.spawn_camp.position;\n      fill.alpha = 0.08;\n      group.x = pos.x;\n      group.y = pos.y;\n      group.addChild(fill);\n      group.addChild(camp);\n      group.cache(-s, -s, s * 2, s * 2);\n      team.spawn_camp.view = group;\n      this.view.layer.action.back.addChild(group);\n    });\n  }\n\n  createShipViews() {\n    let our_ship = this.ships.main, our_team;\n    if (our_ship) our_team = our_ship.owner.team;\n    this.ships.forEach((ship) => {\n      let container = new createjs.Container();\n      var hollow = new createjs.Shape(DeepSpaceGame.graphics.ship[ship.owner.type][0](ship.owner.team.color, ship.isMain ? 4 : 2)),\n        filled = new createjs.Shape(DeepSpaceGame.graphics.ship[ship.owner.type][1](ship.owner.team.color, ship.isMain ? 4 : 2)),\n        s = ship.radius * 1.2;\n      hollow.cache(-s, -s, s * 2, s * 2);\n      filled.cache(-s, -s, s * 2, s * 2);\n      var view = new createjs.Bitmap(hollow.cacheCanvas);\n      view.regX = view.regY = s;\n      view.hollow = hollow.cacheCanvas, view.filled = filled.cacheCanvas; // TODO cache ships with interchangable bitmap instead\n      container.ship = view;\n      container.addChild(view);\n\n      //text\n      if (ship.owner.team == our_team && ship != our_ship) {\n        var text = new createjs.Text(ship.owner.name, \"14px Roboto\", our_team.color);\n        text.textAlign = \"center\";\n        // text.cache(-50, -30, 100, 60)\n        container.text = text;\n        container.addChild(text);\n      }\n\n      // if(ship == our_ship) {\n      //   let color = this.ships.main.owner.team.color,\n      //     view = new createjs.Shape(DeepSpaceGame.graphics.energyMeter(this.ships.main.owner.team.color, 1)),\n      //     shadow = new createjs.Shape(DeepSpaceGame.graphics.energyMeterShadow('#455A64')),\n      //     offset = { x: 22, y: -22 };\n      //\n      //   view.x = shadow.x = offset.x;\n      //   view.y = shadow.y = offset.y;\n      //\n      //   container.addChild(container.meter_shadow = view.shadow = shadow);\n      //   container.addChild(container.meter = view);\n      // }\n\n\n      this.view.layer.action.front.addChild(ship.view = container);\n    });\n\n    if (our_ship) {\n      let container = our_ship.view,\n        color = this.ships.main.owner.team.color,\n        innerRadius = 5 / this.scale,\n        outerRadius = 7 / this.scale,\n        meter = new createjs.Shape(DeepSpaceGame.graphics.energyMeter(this.ships.main.owner.team.color, 1, this.scale)),\n        shadow = new createjs.Shape(DeepSpaceGame.graphics.energyMeterShadow('#455A64', this.scale)),\n        offset = {x: 22, y: -22};\n\n      shadow.cache(-outerRadius, -outerRadius, outerRadius*2, outerRadius*2);\n\n      meter.x = shadow.x = offset.x;\n      meter.y = shadow.y = offset.y;\n\n      container.addChild(container.meter_shadow = meter.shadow = shadow);\n      container.addChild(container.meter = meter);\n    }\n  }\n\n  createPoolViews() {\n    this.view.bullets = new Map()\n    this.view.blocks = new Map()\n    this.view.subs = new Map()\n  }\n\n  // createParticleViews() {\n  //   this.ships.forEach((ship) => {\n  //     var view = ship.view;\n  //\n  //     DeepSpaceGame.renderingParameters.times(() => {\n  //       var particle = DeepSpaceGame.graphics.particle();\n  //       view.reserve.push(new createjs.Shape);\n  //     });\n  //\n  //     this.stage.addChild(ship.view = view);\n  //   });\n  // }\n\n  createOverlayViews() {\n    var overlay = {};\n\n    overlay.score = new createjs.Container();\n    overlay.score.team = [];\n    var imagined_width = 120;\n    this.teams.forEach((team, i) => {\n      var text = new createjs.Text(this.game.scores[i].toString(), \"48px Roboto\", team.color);\n      text.x = (i * imagined_width) + (imagined_width / 2);\n      text.textAlign = \"center\";\n      overlay.score.addChild(text);\n      overlay.score.team.push(text);\n    });\n    overlay.score.x = (this.window.width / 2) - ((this.teams.length * imagined_width) / 2)\n    overlay.score.y = 12;\n\n    this.view.layer.overlay.addChild(overlay.score);\n\n\n\n    // energy meter\n    // if(!this.spectate) {\n    //   overlay.ship = {};\n    //   let color = this.ships.main.owner.team.color,\n    //       view = new createjs.Shape(DeepSpaceGame.graphics.energyMeter(this.ships.main.owner.team.color, 1)),\n    //       shadow = new createjs.Shape(DeepSpaceGame.graphics.energyMeterShadow('#455A64')),\n    //       centerX = this.window.width / 2,\n    //       centerY = this.window.height / 2,\n    //       offset = { x: 22, y: -22 };\n    //\n    //   view.x = shadow.x = centerX + offset.x;\n    //   view.y = shadow.y = centerY + offset.y;\n    //\n    //   this.view.layer.overlay.addChild(view.shadow = shadow);\n    //   this.view.layer.overlay.addChild(overlay.ship.energyMeter = view);\n    // }\n\n    // MINI MAP\n    if (!this.spectate) this.createOverlayMinimapViews(overlay, this.view.layer.overlay);\n\n\n\n    // var imagined_width = 512;\n    overlay.message = new createjs.Text(\"\", \"24px Roboto Condensed\");\n    overlay.message.textAlign = \"center\";\n    overlay.message.x = (this.window.width / 2);\n    overlay.message.y = 76;\n\n    this.view.layer.overlay.addChild(overlay.message);\n\n    // var imagined_width = 512;\n    overlay.kill_message = new createjs.Text(\"\", \"24px Roboto\");\n    overlay.kill_message.textAlign = \"center\";\n    overlay.kill_message.x = (this.window.width / 2);\n    overlay.kill_message.y = this.window.height - 76;\n\n    this.view.layer.overlay.addChild(overlay.kill_message);\n\n    switch (this.gameMode) {\n      case 0: // ctf\n        // var centerX = this.mapInfo.width / 2;\n        // var centerY = this.mapInfo.height / 2;\n\n        var r = DeepSpaceGame.modes[\"ctf\"].flag_radius * this.scale, s = r * 1.2;\n        var flag = new createjs.Shape(\n          DeepSpaceGame.graphics.flag(r)\n        );\n        flag.shadow = DeepSpaceGame.graphics.flag_shadow();\n        flag.cache(-s, -s, s * 2, s * 2);\n\n        // flag.x = centerX; flag.y = centerY;\n\n        this.view.layer.overlay.addChild(flag);\n        this.view.flag = flag;\n\n        break;\n    }\n\n\n    this.view.overlay = overlay;\n  }\n\n  createOverlayMinimapViews(overlay_model, overlay_view) {\n\n    let mini = overlay_model.minimap = new createjs.Container();\n\n    mini.width = mini.height = 168;\n    mini.scale = mini.width / this.mapInfo.width;\n    mini.regX = mini.width/2;\n    mini.regY = mini.height/2;\n    mini.rotation = Math.degrees(-this.ships.main.spawnRotation) - 90;\n\n    let padd = this.window.width < 600 ? 0 : 32;\n    mini.x = (padd) + mini.width/2;\n    mini.y = this.window.height - (padd + mini.height) + mini.height/2\n\n    // background\n    let background = mini.background = new createjs.Shape();\n    background.graphics.beginFill('#263238').drawRect(0, 0, mini.width, mini.height);\n    background.cache(0, 0, mini.width, mini.height);\n    mini.addChild(background);\n\n    // map obstacles\n    var max = 128,\n      r = max * mini.scale,\n      block = new createjs.Shape(DeepSpaceGame.graphics.block_fill('#37474F', r)),\n      s = r * 1.2;\n    block.cache(-s, -s, s * 2, s * 2);\n    var cache = block.cacheCanvas;\n\n    this.model.map.impermeables.forEach(block => {\n      var scale = (block.radius * mini.scale) / r,\n        view = new createjs.Bitmap(cache),\n        pos = block.position;\n      view.scaleX = view.scaleY = scale;\n      view.x = (pos.x * mini.scale) - (scale * cache.width / 2);\n      view.y = (pos.y * mini.scale) - (scale * cache.height / 2);\n      mini.addChild(view);\n    });\n\n    // spawns\n    this.teams.forEach(team => {\n      let camp = team.spawn_camp,\n        radius = team == this.ships.main.owner.team ? 8 : 6,\n        // radius = camp.radius*mini.scale,\n        view = new createjs.Shape(DeepSpaceGame.graphics.circle_fill(team.color, 6)),\n        pos = camp.position;\n      view.x = pos.x * mini.scale;\n      view.y = pos.y * mini.scale;\n      var s = radius * 1.2;\n      view.cache(-s, -s, s * 2, s * 2);\n      mini.addChild(view);\n    });\n\n    // flag\n    if(this.gameMode == 0) {\n      let flag_view = mini.flag = new createjs.Shape(DeepSpaceGame.graphics.circle_fill('#ECEFF1', 6))\n      mini.addChild(flag_view);\n    }\n\n    // ships .. hmmm.. intel >.>\n    // (only same team for now)\n    let this_player = this.ships.main.owner, this_team = this_player.team\n    mini.players = [];\n    this_team.players.forEach(player => {\n      let view = new createjs.Shape(DeepSpaceGame.graphics.circle_fill(this_team.color, 4));\n      view.alpha = player == this_player ? 1 : 0.6;\n      mini.players.push(view);\n      mini.addChild(view);\n    });\n\n    // and also eventually blocks\n    mini.blocks = new Map();\n\n\n    overlay_view.addChild(mini);\n  }\n\n  createOverlayMinimapBlockViewFor(block) {\n    let cache = DeepSpaceGame.graphicsCaches.minimap.blocks[block.team],\n      blv = new createjs.Bitmap(cache),\n      mini = this.view.overlay.minimap,\n      scale = mini.scale;\n\n    // blv.alpha = 0.2\n    blv.x = block.position.x * scale;\n    blv.y = block.position.y * scale;\n\n    blv.regX = blv.regY = (cache.width / 2);\n\n    mini.addChild(blv);\n    mini.setChildIndex(blv, 1)\n    mini.blocks.set(block.id, blv);\n\n    // flag always on top\n    // mini.setChildIndex(mini.flag, mini.numChildren-1)\n  }\n\n  setupCamera() {\n    this.view.layer.action.width = this.mapInfo.width;\n    this.view.layer.action.height = this.mapInfo.height;\n    this.camera = new Camera(this.stage.canvas, this.view.layer.action, this.scale, this.HDPScale);\n\n    if (this.spectate) {\n      this.activePlayerIndex = 0;\n      // this.playerShipViews = new Map();\n      // this.setupData.players.forEach((p, i)=>{\n      //   this.playerShipViews.set(i, this.players.get(p.id).ship.view);\n      // });\n      this.activePlayers = this.setupData.players.map(p => this.players.get(p[0]));\n      this.updateCameraFocus();\n    } else {\n      this.camera.focus = this.ships.main.view;\n    }\n\n    this.camera.width = this.window.width;\n    this.camera.height = this.window.height;\n  }\n\n  setupListeners() { // (needs (even more) work)\n    this.inputHandlers = new Map();\n    var receiver = window;\n\n    if (this.spectate) {\n      var keyHandler = (e) => {\n        if (e.keyCode == 37) { // left: \n          this.activePlayerIndex--;\n          if (this.activePlayerIndex < 0) this.activePlayerIndex = this.activePlayers.length - 1;\n        }\n        if (e.keyCode == 39) { // right: \n          this.activePlayerIndex++;\n          if (this.activePlayerIndex >= this.activePlayers.length) this.activePlayerIndex = 0;\n        }\n        this.updateCameraFocus();\n      }\n      receiver.addEventListener('keydown', keyHandler); // onkeydown\n      this.inputHandlers.set('keydown', keyHandler);\n    } else {\n      // forward :  0 to 1\n      // turn    : -1 to 1\n      // shoot   : true or false\n      // block   : true or false\n      // sub : true or false\n\n      // var keypressWeight = 0.85;\n\n      // var inputStack = new Map([[\"forward\", 0], [\"turn\", 0], [\"shoot\", false], [\"block\", false], [\"sub\", false]]);\n      // var inputStack = new Map([[\"verticle\", 0], [\"horizontal\", 0], [\"shoot\", false], [\"block\", false], [\"sub\", false]]);\n      // var inputStack = new Map([[\"move_v_axis\", 0], [\"move_h_axis\", 0], [\"shoot_v_axis\", 0], [\"shoot_h_axis\", 0], [\"block\", false], [\"sub\", false]]);\n      // var inputStack = new Map([\n      //   [\"up\", 0], [\"dn\", 0], [\"lt\", 0], [\"rt\", 0],         // move direction\n      //   [\"up2\", 0], [\"dn2\", 0], [\"lt2\", 0], [\"rt2\", 0],     // attack direction\n      //   [\"block\", false], [\"sub\", false]                    // other\n      // ]);\n\n      // for(var [,player] of this.players) {\n      //   player.input = [];\n      // }\n      var inputStack = this.ships.main.owner.input = new Set();\n      inputStack.changed = false;\n\n      // KEYBOARD\n      // key mappings, have multiple ('values') so you can switch between key bindings\n      // the default values are true / false\n      var keymap = [\n        // up: \n        [\"up\", [38]],\n        // down: \n        [\"dn\", [40]],\n        // left: \n        [\"lt\", [37]],\n        // right: \n        [\"rt\", [39]],\n        // up: w\n        [\"up2\", [87]],\n        // down: s\n        [\"dn2\", [83]],\n        // left: a\n        [\"lt2\", [65]],\n        // right: d\n        [\"rt2\", [68]],\n        // block: space, v\n        [\"block\", [32, 86]],\n        // sub: e\n        [\"sub\", [69]]\n      ];\n\n      // var values = [\n      //   // up: \n      //   [\"up\", [38], true, false],\n      //   // down: \n      //   [\"dn\", [40], true, false],\n      //   // left: \n      //   [\"lt\", [37], true, false],\n      //   // right: \n      //   [\"rt\", [39], true, false],\n      //   // up: w\n      //   [\"up2\", [87], true, false],\n      //   // down: s\n      //   [\"dn2\", [83], true, false],\n      //   // left: a\n      //   [\"lt2\", [65], true, false],\n      //   // right: d\n      //   [\"rt2\", [68], true, false],\n      //   // block: space\n      //   [\"block\", [32], true, false],\n      //   // sub: e\n      //   [\"sub\", [69], true, false]\n      // ];\n\n      // var values = [\n      //   // up:  , w\n      //   [\"forward\", [38, 87], keypressWeight, 0],\n      //   // right:  , d\n      //   [\"turn\", [39, 68], keypressWeight, 0],\n      //   // left:  , a\n      //   [\"turn\", [37, 65], -keypressWeight, 0],\n      //   // shoot: z , k\n      //   [\"shoot\", [90, 75], true, false],\n      //   // block: x , l\n      //   [\"block\", [88, 76], true, false],\n      //   // block: c , ;\n      //   [\"sub\", [67, 186], true, false]\n\n      // // up:  , w\n      // [\"move_v_axis\", [38, 87], keypressWeight, 0],\n      // // down:  , s\n      // [\"move_v_axis\", [40, 83], -keypressWeight, 0],\n      // // right:  , d\n      // [\"move_h_axis\", [39, 68], keypressWeight, 0],\n      // // left:  , a\n      // [\"move_h_axis\", [37, 65], -keypressWeight, 0],\n      // ];\n\n      let keyHandler = (e) => {\n        var type = e.type;\n\n        if (type == 'keyup' || type == 'keydown') {\n          var eventCode = e.keyCode;\n\n          keymap.forEach((row) => {\n            row[1].forEach((code) => {\n              if (code == eventCode) {\n\n                // row[0] e.g. 'up' or 'block'\n                // row[2] is value on keydown\n                // row[3] is value on keyup\n\n                if (!type.is('keyup')) {\n                  if (!inputStack.has(row[0])) {\n                    inputStack.add(row[0]);\n                    inputStack.changed = true;\n                  }\n                } else {\n                  inputStack.delete(row[0])\n                  inputStack.changed = true;\n                }\n\n                // inputStack.delete(row[0])\n                // if(keydown)\n                // if(!type.is('keyup')) inputStack.add(row[0]);\n\n                // NetworkHelper.out_input_stack(Array.from(inputStack));\n                // inputStack.changed = true;\n                // log(Array.from(inputStack));\n              }\n            });\n          });\n        }\n      };\n\n      receiver.addEventListener('keydown', keyHandler); // onkeydown\n      receiver.addEventListener('keyup', keyHandler); // onkeyup\n\n      this.inputHandlers.set('keydown', keyHandler);\n      this.inputHandlers.set('keyup', keyHandler);\n\n      // GAMEPAD\n      receiver.addEventListener(\"gamepadconnected\", (e) => this.gamepad = e.gamepad);\n      // this closure has access to the inputStack variable.. the alias for this.ships.main.owner.input\n      // .. thus it is left here .. please revise\n      this.updateGamepadInput = (!navigator.getGamepads) ? () => {\n        } : () => {\n          var gamepad = navigator.getGamepads()[0];\n          if (!gamepad) return;\n\n          /*var val, deadZone;\n\n          // UP\n          deadZone = 0.0;\n          val = gamepad.axes[3];\n          val = (val + 1) / 2; // adjusted weird (-1 to 1 back trigger) axis seup\n          val = (val > deadZone) ? (val - deadZone) / (1 - deadZone) : 0;\n          inputStack.set(\"forward\", val);\n\n          // LEFT and RIGHT\n          deadZone = 0.15;\n          val = gamepad.axes[0];\n          val = (val < -deadZone || val > deadZone) ? (val - deadZone) / (1 - deadZone) : 0;\n          inputStack.set(\"turn\", val);\n\n          // FIRE\n          inputStack.set(\"shoot\", gamepad.buttons[3].pressed);\n\n          // BLOCK\n          inputStack.set(\"block\", gamepad.buttons[7].pressed);\n\n          // OTHER\n          inputStack.set(\"sub\", gamepad.buttons[0].pressed);*/\n\n\n          // NEW :)\n          const deadZone = 0.15;\n          const buttonMap = new Map([\n\n            ['up', [\n\n              // - y axis\n              gamepad.axes[1] < -deadZone,\n\n              // l trigger\n              gamepad.axes[3] > 0,\n\n              // d-pad north\n\n            ]],\n\n            ['dn', [\n\n              // + y axis\n              gamepad.axes[1] > deadZone,\n\n              // r trigger\n              gamepad.axes[4] > 0,\n\n            ]],\n\n            ['lt', [\n\n              // - x axis\n              gamepad.axes[0] < -deadZone,\n\n            ]],\n\n            ['rt', [\n\n              // - x axis\n              gamepad.axes[0] > deadZone,\n\n            ]],\n\n            ['up2', [\n\n              // - y axis 2\n              gamepad.axes[5] < -deadZone,\n\n            ]],\n\n            ['dn2', [\n\n              // + y axis 2\n              gamepad.axes[5] > deadZone,\n\n            ]],\n\n            ['lt2', [\n\n              // - x axis 2\n              gamepad.axes[2] < -deadZone,\n\n            ]],\n\n            ['rt2', [\n\n              // + x axis 2\n              gamepad.axes[2] > deadZone,\n\n            ]],\n\n            ['shoot', [\n\n              // buttons a & b\n              gamepad.buttons[0].pressed,\n              gamepad.buttons[1].pressed,\n\n            ]],\n\n            ['block', [\n\n              // r shoulder button\n              gamepad.buttons[7].pressed,\n\n            ]],\n\n            ['sub', [\n\n              // buttons x & y\n              gamepad.buttons[3].pressed,\n              gamepad.buttons[4].pressed,\n\n              // l shoulder button\n              gamepad.buttons[6].pressed,\n\n              // r joystick press\n              gamepad.buttons[14].pressed,\n\n            ]],\n\n          ]);\n\n          for(let [code, bindings] of buttonMap) {\n\n            const activation = _(bindings).contains(true);\n\n            if(activation) {\n\n              if(inputStack.has(code)) continue;\n\n              inputStack.add(code);\n              inputStack.changed = true;\n\n            } else {\n\n              if(!inputStack.has(code)) continue;\n\n              inputStack.delete(code);\n              inputStack.changed = true;\n\n            }\n\n          }\n\n\n        };\n\n      // MOBILE\n      let raw_acc_data = [0, 0], applied_acc_data = [0, 0]; // [x, y]\n      let threshold = 1, bias = [0, 0]; // deadzone\n      bias = ENV.storage.calibration = (ENV.storage.calibration) ? ENV.storage.calibration.split(\",\").map(Number) : [0, 0];\n      // let origin = [0, bias];\n      if (ENV.mobile && window.DeviceMotionEvent != undefined) {\n        window.ondevicemotion = function (e) {\n          raw_acc_data = [e.accelerationIncludingGravity.x, e.accelerationIncludingGravity.y];\n          // if ( e.rotationRate )  {\n          //   document.getElementById(\"rotationAlpha\").innerHTML = e.rotationRate.alpha;\n          //   document.getElementById(\"rotationBeta\").innerHTML = e.rotationRate.beta;\n          //   document.getElementById(\"rotationGamma\").innerHTML = e.rotationRate.gamma;\n          // }\n        }\n\n        inputStack.updateMotion = function () {\n          let orientation = window.orientation,\n            [raw_x, raw_y] = raw_acc_data, [x, y] = [raw_x, raw_y];\n\n          if (orientation === 90) {\n            x = -raw_y, y = raw_x\n          }\n          else if (orientation === -90) {\n            x = raw_y, y = -raw_x\n          }\n          else if (orientation === 180 || orientation === -180) {\n            x = -x, y = -y\n          }\n\n          applied_acc_data = [x, y];\n          x -= bias[0]; // bias towards player;\n          y -= bias[1];\n\n          if (x > threshold) {\n            inputStack.add('rt')\n          } else {\n            inputStack.delete('rt')\n          }\n          if (x < -threshold) {\n            inputStack.add('lt')\n          } else {\n            inputStack.delete('lt')\n          }\n          if (y > threshold) {\n            inputStack.add('up')\n          } else {\n            inputStack.delete('up')\n          }\n          if (y < -threshold) {\n            inputStack.add('dn')\n          } else {\n            inputStack.delete('dn')\n          }\n\n        };\n      }\n\n      var left = document.querySelector('#touch_layer > .left');\n      left.addEventListener('touchstart', e => {\n        inputStack.add('block')\n      });\n      left.addEventListener('touchend', e => {\n        inputStack.delete('block')\n      });\n\n      let joystick = new V2D(), joystick_deadzone_radius = 30;\n      var right = document.querySelector('#touch_layer > .right');\n      right.addEventListener('touchstart', e => {\n        inputStack.add('shoot')\n      });\n      right.addEventListener('touchend', e => {\n        inputStack.delete('shoot');\n        inputStack.delete('up2');\n        inputStack.delete('dn2');\n        inputStack.delete('lt2');\n        inputStack.delete('rt2');\n      });\n      var right_hammer = new Hammer(right);\n      right_hammer.on('panmove', function (e) {\n        var v = new V2D(e.deltaX, e.deltaY), a = v.angle;\n        if (v.length > joystick_deadzone_radius) {\n          if (a < -0.39 && a > -2.74) {\n            inputStack.add('up2')\n          } else {\n            inputStack.delete('up2')\n          }\n          if (a > 0.39 && a < 2.74) {\n            inputStack.add('dn2')\n          } else {\n            inputStack.delete('dn2')\n          }\n          if (a > 1.96 || a < -1.96) {\n            inputStack.add('lt2')\n          } else {\n            inputStack.delete('lt2')\n          }\n          if (a > -1.18 && a < 1.18) {\n            inputStack.add('rt2')\n          } else {\n            inputStack.delete('rt2')\n          }\n        } else {\n\n        }\n        // console.log(e)\n      });\n\n      var hammertime = new Hammer(document.querySelector('#touch_layer'));\n      hammertime.get('tap').set({taps: 2})\n      hammertime.get('swipe').set({direction: Hammer.DIRECTION_LEFT})\n      hammertime.on('tap', function (ev) {\n        inputStack.add('sub');\n        ( () => inputStack.delete('sub') ).wait(200);\n      });\n      hammertime.on('swipe', function (e) {\n        // calibrate\n        bias = applied_acc_data;\n        ENV.storage.calibration = bias;\n      });\n\n\n    }\n\n  }\n\n  setupPhysics() {\n    this.setupCollisionSystem();\n    this.assignCollisionPatterns();\n    this.setupReferenceGroups();\n  }\n\n  setupCollisionSystem() {\n    let physics = this.physics = {};\n\n    physics.block_size = 512;\n    physics.world_size = {width: this.mapInfo.width, height: this.mapInfo.height};\n\n    let rows = Math.ceil(physics.world_size.width / physics.block_size),\n      cols = Math.ceil(physics.world_size.height / physics.block_size);\n\n    physics.divisions = [];\n    // rows.times(i => {\n    //   physics.divisions.push([]);\n    //   cols.times(() => {\n    //     physics.divisions[i].push(new Set())\n    //   })\n    // })\n\n    physics.division_index = function (x, y) {\n      return (y * cols) + x;\n    }\n\n    physics.division_coordinates = function (i) {\n      return [i % rows, Math.floor(i / cols)]\n    }\n\n    /* collision testing will be composed of the following:\n\n     within each division, all the tests will be performed\n     with the objects available\n\n     each division will contain all the collision groups within..\n     they will be populated accordingly so when the tests are run\n     tests between objects listed in the groups in the division\n     will be tested. */\n    physics.collision_checks = [];\n    physics.collision_groups = {\n      SHIPS: Symbol('SHIPS'),\n      OUR_SHIP: Symbol('OUR_SHIP'),\n      OUR_SHIPS: Symbol('OUR_SHIPS'),\n      ENEMY_SHIPS: Symbol('ENEMY_SHIPS'),\n\n      BULLETS: Symbol('BULLETS'),\n      MY_BULLETS: Symbol('MY_BULLETS'),\n      OUR_BULLETS: Symbol('OUR_BULLETS'),\n      ENEMY_BULLETS: Symbol('ENEMY_BULLETS'),\n\n      BLOCKS: Symbol('BLOCKS'),\n      OUR_BLOCKS: Symbol('OUR_BLOCKS'),\n      ENEMY_BLOCKS: Symbol('ENEMY_BLOCKS'),\n\n      OUR_PROJ_SUBS: Symbol('OUR_PROJ_SUBS'),\n\n      SPAWN_CAMPS: Symbol('SPAWN_CAMPS'),\n      OUR_SPAWN_CAMP: Symbol('OUR_SPAWN_CAMP'),\n      ENEMY_SPAWN_CAMPS: Symbol('ENEMY_SPAWN_CAMPS'),\n\n      REFUGE: Symbol('REFUGE'), // block or camp\n      OUR_REFUGE: Symbol('OUR_REFUGE'),\n\n      FLAG: Symbol('FLAG'),\n      IMPERMEABLES: Symbol('IMPERMEABLES')\n    };\n\n\n    (rows * cols).times(() => {\n      let obj = {};\n      for (let group of Object.keys(physics.collision_groups)) obj[physics.collision_groups[group]] = new Set();\n      physics.divisions.push(obj);\n    })\n\n    /*\n     END RESULT LOOKS SOMETHING LIKE:\n     [.. {...}, {SHIPS: [Set], OUR_BULLETS: Set [b, b, ..], ...}, {...}, ...]\n\n     */\n  }\n\n  setCollisionDivisions(physics_body) {\n    this.clearCollisionDivisions(physics_body)\n\n    let d = physics_body.divisions = new Set(),\n      r = physics_body.radius,\n      [x, y] = [physics_body.position.x, physics_body.position.y];\n\n    [[1, 0], [0, -1], [-1, 0], [0, 1]].forEach(unit_offset_array => {\n      let check_x = x + (r * unit_offset_array[0]),\n        check_y = y + (r * unit_offset_array[1]);\n\n      let division_x = Math.floor(check_x / this.physics.block_size),\n        division_y = Math.floor(check_y / this.physics.block_size),\n        division_index = this.physics.division_index(division_x, division_y);\n\n      if (this.physics.divisions[division_index]) d.add(division_index);\n    });\n\n    for (let division_index of d)\n      for (let group of physics_body.collision_groups)\n        this.physics.divisions[division_index][group].add(physics_body);\n  }\n\n  clearCollisionDivisions(physics_body) {\n    if (physics_body.divisions) {\n      for (let i of physics_body.divisions)\n        for (let group of physics_body.collision_groups)\n          this.physics.divisions[i][group].delete(physics_body);\n    }\n  }\n\n  assignCollisionPatterns() {\n    let checks = this.physics.collision_checks,\n      groups = this.physics.collision_groups;\n\n\n    if (!this.spectate) {\n\n      // MY BULLET <-> ENEMY SHIPS\n      checks.push([\n        groups.MY_BULLETS,\n        groups.ENEMY_SHIPS,\n        (bullet, ship) => {\n          if (!bullet.disabled && !ship.disabled) {\n            this.damageShip(ship.owner.id, bullet.hp, bullet.creator)\n            this.removeBullet(bullet.id)\n          }\n        }]\n      );\n\n      // MY BULLET <-> ENEMY BLOCKS\n      checks.push([\n        groups.MY_BULLETS,\n        groups.ENEMY_BLOCKS,\n        (bullet, block) => {\n          if (!bullet.disabled && !block.disabled) {\n            this.damageBlock(block.id, bullet.hp)\n            if (bullet.hp < block.hp) this.removeBullet(bullet.id);\n          }\n        }]\n      );\n\n      // MY BULLET <-> ENEMY SPAWN_CAMPS\n      checks.push([\n        groups.MY_BULLETS,\n        groups.ENEMY_SPAWN_CAMPS,\n        (bullet, spawn_camp) => {\n          if (!bullet.disabled) {\n            this.removeBullet(bullet.id);\n          }\n        }]\n      );\n\n      // OUR BULLET <-> IMPERMEABLES\n      // checks.push([\n      //   groups.OUR_BULLETS,\n      //   groups.IMPERMEABLES,\n      //   (bullet, imp) => {\n      //     if(!bullet.disabled) {\n      //       NetworkHelper.bullet_destroy(bullet.id);\n      //     }\n      //   }]\n      // );\n\n      // // OUR SHIP <-> OUR REFUGE\n      // checks.push([\n      //   groups.OUR_SHIP,\n      //   groups.OUR_REFUGE,\n      //   (ship, refuge) => {\n      //     if(!ship.disabled) ship.charging = true;\n      //   }]\n      // );\n\n      // OUR SHIP <-> FLAG\n      checks.push([\n        groups.OUR_SHIP,\n        groups.FLAG,\n        (ship, flag) => {\n          if (!ship.disabled && flag.idle)\n            if(ship.canPickupFlag())\n              this.assumeFlag(ship);\n        }]\n      );\n\n      // OUR SUBS <-> ENEMY BLOCKS\n      checks.push([\n        groups.OUR_PROJ_SUBS,\n        groups.ENEMY_BLOCKS,\n        (sub, block) => {\n          if (!sub.disabled && !block.disabled) {\n            switch (sub.type) {\n              case 'attractor':\n              case 'repulsor':\n                // NetworkHelper.sub_destroy(sub.id);\n                // NetworkHelper.block_destroy(block.id);\n                break;\n              case 'block_bomb':\n              case 'missile':\n                sub.explode();\n                break;\n            }\n          }\n        }]\n      );\n\n      // OUR SUBS <-> ENEMY SHIPS\n      checks.push([\n        groups.OUR_PROJ_SUBS,\n        groups.ENEMY_SHIPS,\n        (sub, ship) => {\n          if (!sub.disabled && !ship.disabled) {\n            if (sub.type == 'missile') {\n              this.damageShip(ship.owner.id, sub.hp, sub.player);\n              this.removeSub(sub.id)\n            }\n          }\n        }]\n      );\n\n      // OUR SUBS <-> ENEMY SPAWN_CAMPS\n      checks.push([\n        groups.OUR_PROJ_SUBS,\n        groups.ENEMY_SPAWN_CAMPS,\n        (sub, spawn_camp) => {\n          if (!sub.disabled) this.removeSub(sub.id);\n        }]\n      );\n\n      // OUR BLOCKS <-> OUR BLOCKS\n      checks.push([\n        groups.OUR_BLOCKS,\n        groups.OUR_BLOCKS,\n        (block_a, block_b) => {\n          if (block_a != block_b && !block_a.disabled && !block_b.disabled)\n            if (Physics.overlap(block_a, block_b) > 0.8) // 0.8\n              this.removeBlock(block_a.id);\n        }]\n      );\n\n    }\n\n    // SHIPS <-> WALL OR CAMP (REFUGE)\n    checks.push([\n      groups.SHIPS,\n      groups.REFUGE,\n      (ship, refuge) => {\n        if (!ship.disabled) {\n          if (ship.owner.team.number != refuge.team) {\n            Physics.bounce(ship, refuge);\n          } else {\n            ship.charging = true;\n          }\n        }\n      }]\n    );\n\n    // SHIPS <-> IMPERMEABLES\n    checks.push([\n      groups.SHIPS,\n      groups.IMPERMEABLES,\n      (ship, imp) => {\n        if (!ship.disabled) {\n          Physics.bounce(ship, imp);\n        }\n      }]\n    );\n\n    // BULLETS <-> IMPERMEABLES\n    checks.push([\n      groups.BULLETS,\n      groups.IMPERMEABLES,\n      (bullet, imp) => {\n        if (!bullet.disabled) {\n          if (Physics.overlap(bullet, imp) < 0.1) {\n            Physics.bounce(bullet, imp);\n          } else {\n            this.removeBullet(bullet.id);\n          }\n        }\n      }]\n    );\n\n  }\n\n  setupReferenceGroups() {\n    var refGroups = {};\n\n    refGroups.enemyBlocks = new Set();\n    refGroups.enemySubs = new Set();\n\n    refGroups.animate = new Set();\n\n    // this.collisionGroups = groups;\n    this.refGroups = refGroups;\n  }\n\n  setupLoop() {\n    var FPS = n => 1000 / n;\n    window.getAnimationFrame =\n      window.requestAnimationFrame ||\n      window.webkitRequestAnimationFrame ||\n      window.mozRequestAnimationFrame ||\n      window.oRequestAnimationFrame ||\n      window.msRequestAnimationFrame ||\n      function (callback) {\n        window.setTimeout(callback, FPS(60))\n      };\n\n    this.setupDT();\n  }\n\n  setupDT() {\n    this.last_time = (new Date()).getTime();\n\n    // the variable percentage of a second that has gone by since the last frame\n    // usually expressed: 0.016 when running 60 fps\n    this.dt = 0;\n  }\n\n  updateDT() {\n    let now = (new Date()).getTime();\n    this.dt = (now - this.last_time) / 1000;\n    this.last_time = now;\n  }\n\n  setupReferences() {\n    this.setupShortcutsToCommonCalls();\n    this.setupFinishCollisionAssignment();\n    this.setupGraphicsCaches();\n  }\n\n  setupShortcutsToCommonCalls() {\n    if (!this.spectate) {\n      // model references\n      this.enemyTeams = this.teams.filter(team => team.number != this.ships.main.owner.team.number);\n      this.enemyPlayers = this.enemyTeams.reduce((list, team) => list.concat(team.players), []);\n\n      this.player = this.ships.main.owner;\n      this.team = this.player.team;\n    }\n  }\n\n  setupFinishCollisionAssignment() {\n    /*\n     this method is run near end of the setup since things like ships and players\n     and teams and everything else is assigned and references can be made to the\n     local players team and such..\n     */\n\n    // spawn camps\n    this.teams.forEach(team => {\n      let spawn_c = team.spawn_camp;\n      spawn_c.collision_groups = [this.physics.collision_groups.SPAWN_CAMPS, this.physics.collision_groups.REFUGE] // TODO COLLISION OR PHYSICS CLASS PROTOCOLS\n      if (team == this.team) {\n        spawn_c.collision_groups.push(this.physics.collision_groups.OUR_SPAWN_CAMP);\n        spawn_c.collision_groups.push(this.physics.collision_groups.OUR_REFUGE);\n      } else {\n        spawn_c.collision_groups.push(this.physics.collision_groups.ENEMY_SPAWN_CAMPS);\n      }\n      this.setCollisionDivisions(spawn_c);\n    });\n\n    // ships\n    this.ships.forEach(ship => {\n      ship.collision_groups = [this.physics.collision_groups.SHIPS];\n      if (ship == this.ships.main) ship.collision_groups.push(this.physics.collision_groups.OUR_SHIP);\n      ship.collision_groups.push((ship.owner.team == this.team) ? this.physics.collision_groups.OUR_SHIPS : this.physics.collision_groups.ENEMY_SHIPS)\n    });\n  }\n\n  setupGraphicsCaches() {\n    // TODO: deinit graphics caches\n\n    // cache background\n    // this.view.layer.background.cache(0, 0, this.mapInfo.width, this.mapInfo.height);\n\n    // create single cache for common objects\n    this.setupCommonGraphicsCachePool();\n  }\n\n\n  setupCommonGraphicsCachePool() {\n    let gc = DeepSpaceGame.graphicsCaches = {};\n\n    // bullets\n    gc.bullets = [];\n    this.teams.forEach(team => {\n\n      // always caching the largest version\n      let radius = Bullet.stats.MAX_RADIUS;\n\n      let v = new createjs.Shape(\n        DeepSpaceGame.graphics.particle(this.teams[team.number].color, radius)\n      );\n\n      var s = radius * 1.2;\n      v.cache(-s, -s, s * 2, s * 2);\n\n      gc.bullets[team.number] = v.cacheCanvas;\n    });\n\n    // blocks\n    gc.blocks = {\n      unlocked: [],\n      locked: [],\n      enemy: []\n    };\n    this.teams.forEach(team => {\n\n      // always caching the largest version\n      let radius = Block.stats.MAX_RADIUS;\n\n\n      let fill = new createjs.Shape(DeepSpaceGame.graphics.block_fill(this.teams[team.number].color, radius)),\n        border = new createjs.Shape(DeepSpaceGame.graphics.block_border(this.teams[team.number].color, radius));\n\n      var s = radius * 1.2;\n\n      // enemy\n      fill.cache(-s, -s, s * 2, s * 2);\n      gc.blocks.enemy[team.number] = fill.cacheCanvas;\n\n      // unlocked\n      fill.alpha = 0.16;\n      let c = new createjs.Container();\n      c.addChild(fill);\n      c.cache(-s, -s, s * 2, s * 2);\n      gc.blocks.unlocked[team.number] = c.cacheCanvas;\n\n      // locked\n      c = new createjs.Container();\n      c.addChild(fill);\n      c.addChild(border);\n      c.cache(-s, -s, s * 2, s * 2);\n      gc.blocks.locked[team.number] = c.cacheCanvas;\n    });\n\n    // minimap\n    if (this.spectate) return; // TODO make minimap accesible to all even spectators\n    gc.minimap = {blocks: []};\n    this.teams.forEach(team => {\n      // '#37474F'\n      let radius = Block.stats.MAX_RADIUS * this.view.overlay.minimap.scale;\n\n      let fill = new createjs.Shape(DeepSpaceGame.graphics.block_fill(COLOR.mix(this.teams[team.number].color, '#37474F', 40), radius));\n\n      var s = radius * 1.2;\n      // fill.alpha = 0.16;\n      fill.cache(-s, -s, s * 2, s * 2);\n      gc.minimap.blocks[team.number] = fill.cacheCanvas;\n    });\n    // (()=>{\n    //   let radius = 128 * this.view.overlay.minimap.scale;\n    //\n    //   let fill = new createjs.Shape(DeepSpaceGame.graphics.block_fill(, radius));\n    //\n    //   var s = radius * 1.2;\n    //   // fill.alpha = 0.16;\n    //   fill.cache(-s, -s, s*2, s*2);\n    //   gc.minimap.blocks[team.number] = fill.cacheCanvas;\n    //\n    //   gc.minimap.impermeables = ;\n    // })\n  }\n\n  actualize() {\n    // bring an outside game up to speed\n    // DEPRECIATED :: .. no client can join match after start\n\n    // scores\n    // this.setupData.state.scores.forEach((entry) => {\n    //   this.game.scores[entry.t] = entry.s\n    // });\n    this.setupData.teams.forEach((team, i) => {\n      this.game.scores[i] = 100\n    });\n\n    // flag\n    // var holder;\n    // setTimeout(() => {\n    //   if (holder = this.setupData.state.flagHolder) this.pickupFlag(holder);\n    // }, 100);\n\n    // disconnects\n    // this.setupData.disconnects.forEach(id => this.disconnectPlayer(id))\n\n  }\n\n\n  loop() {\n    // stats.begin();\n    this.updateDT();\n    this.update();\n    this.log();\n    // stats.end();\n\n    // NetworkHelper.release();\n\n    getAnimationFrame(() => this.game.ended ? true : this.loop())\n  }\n\n  update() {\n    // this function duty is as follows:\n    // to update all the moving parts pertaining to the current/local user.\n    // any collisions should be sent back to the server to sync the changes.\n    var over = this.game.disabled;\n    if (!over) this.updateInput();\n    this.updateModel(); // TODO: improve performance\n    if (!over) this.checkForCollisions();\n    // if(this.isHost) this.generateMapEntities();\n\n    if (!over) this.updateGame();\n\n    this.updateView();\n  }\n\n  updateInput() {\n    if(!this.spectate) this.updateGamepadInput();\n    if (!this.spectate) if (this.player.input.updateMotion) this.player.input.updateMotion();\n  }\n\n  // updateGamepadInput() {}\n\n  updateModel() {\n    this.updateShips();\n    this.broadcastShip();\n\n    this.updateBullets();\n    this.updateBlocks();\n    this.updateSubs();\n  }\n\n  updateShips() {\n    for (var ship of this.ships) {\n\n      ship.update(this.dt);\n\n      if (ship == this.ships.main && !ship.disabled) {\n\n        var input = ship.owner.input,\n          x = 0, y = 0, x2 = 0, y2 = 0,\n          s = false;\n\n        for (var prop of input) {\n          switch (prop) {\n            case 'up':\n              y = 1;\n              // y = -1;\n              break;\n            case 'dn':\n              y = -1;\n              // y = 1;\n              break;\n            case 'lt':\n              x = -1;\n              break;\n            case 'rt':\n              x = 1;\n              break;\n            case 'up2':\n              y2 = -1;\n              break;\n            case 'dn2':\n              y2 = 1;\n              break;\n            case 'lt2':\n              x2 = -1;\n              break;\n            case 'rt2':\n              x2 = 1;\n              break;\n            case 'sub':\n              // if(!ship.flag) ship.sub();\n              if(ship.flag) {\n                this.releaseFlag()\n              } else {\n                if(ship.canSub())\n                  this.addSub(ship);\n              }\n              break;\n            case 'block':\n              if(ship.canBlock()) {\n                if(ship.reachedBlockLimit) this.removeBlock(ship.oldestBlockID())\n                this.addBlock(ship)\n              }\n              break;\n            case 'shoot':\n              s = true;\n              break;\n          }\n        }\n\n        // ship.acceleration.set({x, y})\n        // if (ship.acceleration.length) ship.acceleration.length = ship.LINEAR_ACCELERATION_LIMIT;\n        //\n        // // if(ship.acceleration.length) ship.angle = ship.acceleration.angle\n        // if (ship.velocity.length) ship.angle = ship.velocity.angle;\n\n        var direction_v = new V2D(x2, y2)\n        ship.relative_shoot_angle = direction_v.length ? direction_v.angle + (Math.PI/2) : 0;\n\n\n        // new ship controls\n        ship.acceleration = ship.LINEAR_ACCELERATION_LIMIT * y;\n        ship.angular_acceleration = ship.ANGULAR_ACCELERATION_LIMIT * x;\n\n\n        // if(direction_v.length) ship.shoot();\n\n\n        if (s || direction_v.length)\n          if (ship.canShoot())\n            this.addBullet(ship);\n      }\n\n      // validate new position TODO (revise)\n      let r = ship.radius + 8;\n      if (ship.position.x - r < 0) {\n        ship.position.x = r;\n        ship.velocity.x = 0\n      }\n      if (ship.position.y - r < 0) {\n        ship.position.y = r;\n        ship.velocity.y = 0\n      }\n      if (ship.position.x + r > this.mapInfo.width) {\n        ship.position.x = this.mapInfo.width - r;\n        ship.velocity.x = 0;\n      }\n      if (ship.position.y + r > this.mapInfo.height) {\n        ship.position.y = this.mapInfo.height - r;\n        ship.velocity.y = 0;\n      }\n\n      this.setCollisionDivisions(ship);\n\n      // if(ship.position.x < 0) Physics.bounce_off_line(ship, V2D.new(0, 0), V2D.new(0, this.mapInfo.height))\n      // if(ship.position.y < 0) Physics.bounce_off_line(ship, V2D.new(0, 0), V2D.new(0, this.mapInfo.width))\n      // if(ship.position.x > this.mapInfo.width) Physics.bounce_off_line(ship, V2D.new(0, this.mapInfo.height))\n      // if(ship.position.y > this.mapInfo.height) Physics.bounce_off_line(ship, V2D.new(0, this.mapInfo.width))\n\n      // if(ship.position.x < 0) ship.position.x = this.mapInfo.width;\n      // if(ship.position.y < 0) ship.position.y = this.mapInfo.height;\n      // if(ship.position.x > this.mapInfo.width) ship.position.x = 0;\n      // if(ship.position.y > this.mapInfo.height) ship.position.y = 0;\n    }\n  }\n\n  broadcastShip() {\n    var ship, input;\n    if ((ship = this.ships.main) && (input = ship.owner.input)) {\n      if (input.changed) {\n        // log(Array.from(input));\n        // NetworkHelper.out_input_stack(Array.from(input));\n        input.changed = false;\n      }\n\n      this.network.sendShipUpdate(ship.export_update());\n\n      if ((new Date()).getTime() % 60 < 2) this.network.sendShipOverride(ship.export_override());\n      if (ship.flag && ship.disabled) this.releaseFlag();\n      // if(ship.flag && ship.disabled && !this.game.flag.idle) NetworkHelper.out_flag_drop();\n    }\n  }\n\n  updateBullets() {\n    this.model.bullets.forEach(b => {\n      b.update(this.dt);\n      this.setCollisionDivisions(b)\n    });\n    // this.model.bullets.forEach(b => { b.update(); if(b.disabled) NetworkHelper.out_bullet_destroy(b.id) });\n  }\n\n  updateBlocks() { // needs needs work\n    this.model.blocks.forEach(b => {\n      if (b.locked) return;\n      if (b.qualified) {\n        this.setCollisionDivisions(b);\n        if (!this.spectate) this.createOverlayMinimapBlockViewFor(b);\n        if (!this.spectate) if (b.team != this.team.number) this.refGroups.enemyBlocks.add(b); // TODO REVISE AFTER NEW COLLISION SYSTEM!!\n        b.locked = true;\n        b.qualified = false;\n      }\n      b.update(this.dt);\n      // if(b.disabled) NetworkHelper.out_block_destroy(b.id) // due to aging\n    });\n  }\n\n  updateSubs() {\n    this.model.subs.forEach(p => {\n      p.update(this.dt);\n      if (p.collision_groups) this.setCollisionDivisions(p);\n\n      switch (p.type) {\n        case 'attractor':\n        case 'repulsor':\n\n          // field effects TODO is games responsibility..? dt is passed to subs themseves..\n          var distance, direction;\n          this.model.bullets.forEach((b) => {\n            if (!b.disabled && p.team != b.team) {\n              if ((distance = Physics.distance(b.position, p.position)) < p.RANGE) {\n                var force = new V2D();\n                direction = p.position.copy();\n                direction.sub(b.position);\n                force.length = p.INTENSITY_FUNCTION(distance);\n                force.angle = direction.angle;\n                if (p.type == 'repulsor') force.angle = force.angle - Math.PI;\n                b.velocity.add(force);\n                b.velocity.length *= 0.94; // friction TODO\n              }\n            }\n          });\n\n          break;\n        case 'block_bomb':\n\n\n          if (p.exploding) {\n\n            // only the player who created it hands out damage to the blocks so it is done once\n            var ship;\n            if ((ship = this.ships.main) && (ship.subs.has(p.id))) {\n              var distance;\n              this.refGroups.enemyBlocks.forEach(block => {\n                if (block && !block.disabled) {\n                  if ((distance = Physics.distance(block.position, p.position)) < p.EXPLOSION_RANGE) {\n                    this.damageBlock(block.id, p.EXPLOSION_DAMAGE_FUNCTION(distance));\n                  }\n                }\n              });\n            }\n\n            // the player is the only one who must wait, the others have been notified to endSub\n            this.removeSub(p.id);\n          }\n\n          break;\n        case 'stealth_cloak':\n          if(p.disabled) ENV.game.destroySub(p.id);\n          break;\n        case 'missile':\n\n          // targeting\n          if (p.target && (Physics.distance(p.target.position, p.position) > p.VISION_RANGE || p.target.stealth)) p.target = null;\n          this.ships.forEach(ship => {\n            if (ship && !ship.disabled && !ship.stealth && ship.owner.team.number != p.team) {\n              if (!p.target && ((distance = Physics.distance(ship.position, p.position)) < p.VISION_RANGE)) {\n                p.target = ship;\n              }\n            }\n          });\n\n          // exploding\n          if (p.exploding) {\n\n            // only the player who created it hands out damage to the blocks so it is done once\n            var ship;\n            if ((ship = this.ships.main) && (ship.subs.has(p.id))) {\n              var distance;\n              this.refGroups.enemyBlocks.forEach(block => {\n                if (block && !block.disabled) {\n                  if ((distance = Physics.distance(block.position, p.position) - block.radius) < p.EXPLOSION_RANGE) {\n                    this.changeBlock(block.id, ship.owner.team.number)\n                  }\n                }\n              });\n            }\n\n            // the player is the only one who must wait, the others have been notified to endSub\n            this.removeSub(p.id);\n          }\n\n          break;\n        default:\n          break;\n      }\n\n\n    });\n\n  }\n\n  checkForCollisions() {\n    // in theory, the user will only check\n    // collisions of those things which it\n    // created. though in practice, perhaps\n    // just it's attack moves. e.g. bullets\n\n    for (let div of this.physics.divisions) {\n      for (var [a_type, b_type, check] of this.physics.collision_checks)\n        for (let body_a of div[a_type])\n          for (let body_b of div[b_type])\n            if (Physics.doTouch(body_a, body_b))\n              check(body_a, body_b);\n    }\n\n  }\n\n  updateGame() {\n    switch(this.gameMode) {\n\n      case 0: // ctf\n\n        var flag = this.game.flag;\n        if (!flag.idle) {\n          var player = this.players.get(flag.holderID),\n            p = player.ship.last_known_position,\n            camp = player.team.spawn_camp;\n          flag.position.x = p.x;\n          flag.position.y = p.y;\n\n          this.setCollisionDivisions(flag);\n\n          // real game stuff\n          var distance = Physics.distance(p, camp.position) - camp.radius,\n            percent = distance / this.game.max,\n            low_score = this.game.scores[player.team.number],\n            current_score = Math.round(percent * 100);\n\n          if (current_score < low_score && current_score >= 0) this.game.scores[player.team.number] = current_score;\n\n          if ((percent < 0) && player == this.player) this.network.sendFlagProgress([player.team.number, current_score])\n          // this.network.out_game_over(player.team.number);\n\n\n          // LEAD COMPARISON\n          // replace lead if none exists\n          if (!this.game.lead) this.game.lead = player.team;\n\n          // replace lead if record shows\n          if (current_score < this.game.scores[this.game.lead.number]) {\n\n            if (!this.spectate) {\n              // if you are replacing\n              if (player.team == this.team) {\n                let c = this.team.color;\n                this.alert(\n                  DeepSpaceGame.localizationStrings.alerts['teamTakesLead'][this.language]()\n                  , c);\n                this.network.sendFlagProgress([player.team.number, current_score])\n                // if (this.game.overtime) this.network.out_game_over(this.team.number);\n              }\n              // if you are being replaced\n              else if (this.game.lead == this.team) {\n                let c = player.team.color;\n                this.alert(\n                  DeepSpaceGame.localizationStrings.alerts['teamLosesLead'][this.language]()\n                  , c);\n              }\n            }\n\n            this.game.lead = player.team;\n          }\n\n\n        }\n\n        break;\n\n      case 1:\n\n\n\n        break;\n\n    } // end switch\n\n\n  }\n\n  updateView() {\n    this.updateShipViews();\n    this.updateBulletViews();\n    this.updateBlockViews();\n    this.updateSubViews();\n\n    this.updateCamera();\n    this.updateBackground();\n    this.updateMap();\n    this.updateTINT();\n    // this.updateGrid();\n\n    this.updateGameViews();\n\n    if (!this.spectate) this.updateMinimapView()\n\n    this.stage.update(); // render changes!!\n  }\n\n  updateShipViews() {\n    this.ships.forEach((ship) => {\n\n      if (ship.view.visible = this.camera.showing(ship) || ship.view == this.camera.focus) {\n\n        var visibility = 1;\n        if (ship.disabled) {\n          visibility = 0;\n        } else if (ship.stealth) {\n          if (ship.owner.team == this.team) {\n            visibility = Math.flipCoin(0.2) ? 0 : 0.4;\n          } else {\n            visibility = 0;\n          }\n        } else {\n          visibility = 1;\n        }\n\n        let ship_view = ship.view.ship;\n        ship_view.alpha = ship.health * visibility;\n        ship_view.rotation = Math.degrees(ship.angle);\n\n        ship.view.x = ship.position.x;\n        ship.view.y = ship.position.y;\n\n        // ship.view.graphics.clear();\n        ship_view.image = ((ship.flag) ? ship_view.filled : ship_view.hollow);\n      }\n\n    });\n    this.updateEnergyMeterView();\n    this.updateNameViews();\n  }\n\n  updateEnergyMeterView() {\n    if (this.spectate) return;\n\n    let ship = this.player.ship,\n      meterView = ship.view.meter,\n      shadowView = meterView.shadow,\n      percent = ship.energy / 100,\n      offset = V2D.new({angle: ship.angle + (Math.PI/4), length: 30 / this.scale});\n    meterView.graphics = DeepSpaceGame.graphics.energyMeter(this.team.color, percent, this.scale);\n    meterView.alpha = shadowView.alpha = ship.disabled ? 0 : 1;\n    meterView.x = shadowView.x = offset.x\n    meterView.y = shadowView.y = offset.y\n    meterView.rotation = shadowView.rotation = Math.degrees(ship.angle + Math.PI/2)\n  }\n\n  updateNameViews() {\n    if (this.spectate) return;\n\n    let our_ship = this.ships.main, our_team;\n    if (our_ship) our_team = our_ship.owner.team;\n\n    this.ships.forEach((ship) => {\n      if (ship.owner.team == our_team && ship != our_ship) {\n        let textView = ship.view.text,\n            offset = V2D.new({angle: our_ship.angle, length: 30});\n        textView.x = offset.x\n        textView.y = offset.y\n        textView.rotation = Math.degrees(our_ship.angle + Math.PI/2)\n      }\n    });\n\n  }\n\n  updateBulletViews() {\n    var views = this.view.bullets;\n    this.model.bullets.forEach(b => {\n      var v = views.get(b.id);\n      if (v.visible = this.camera.showing(b)) {\n        v.x = b.position.x;\n        v.y = b.position.y;\n      }\n    });\n  }\n\n  updateBlockViews() {\n    var views = this.view.blocks;\n    this.model.blocks.forEach(b => {\n      var v = views.get(b.id);\n      if (!b.locked || (v.visible = this.camera.showing(b))) {\n        v.alpha = (b.health * 0.9 + 0.1);\n        if (!b.locked) {\n          v.x = b.position.x;\n          v.y = b.position.y;\n          // v.graphics.command.radius = b.radius;\n          v.scaleX = v.scaleY = (b.radius / Block.stats.MAX_RADIUS) * b.scale;\n        }\n      }\n      if (b.qualified) {\n        let type = b.isForeign ? 'enemy' : 'locked';\n        v.image = DeepSpaceGame.graphicsCaches.blocks[type][b.team];\n      }\n    });\n  }\n\n  updateSubViews() {\n    var views = this.view.subs;\n    this.model.subs.forEach(p => {\n      var v = views.get(p.id);\n      if (v) {\n        v.x = p.position.x;\n        v.y = p.position.y;\n        v.rotation = Math.degrees(p.rotation);\n      }\n    });\n  }\n\n  updateCamera() {\n    this.camera.update();\n    // if(camera.position)\n  }\n\n  updateBackground() {\n    const background = this.view.layer.background.map_background;\n    const map_width = this.mapInfo.width;\n    const map_height = this.mapInfo.height;\n    const half_window_width = this.window.width/2;\n    const half_window_height = this.window.height/2;\n    const half_background_width = background.cacheCanvas.width / 2;\n    const half_background_height = background.cacheCanvas.height / 2;\n    let backgroundPositionVector = V2D.new(this.camera.focus);\n    const centerOffset = V2D.new({x: this.camera.offset.x - half_window_width, y: this.camera.offset.y - half_window_height});\n\n    centerOffset.div(this.scale)\n    centerOffset.angle = Math.radians(this.camera.focus.ship.rotation);\n    backgroundPositionVector.add(centerOffset);\n\n    // edges\n    if (backgroundPositionVector.x < half_background_width) backgroundPositionVector.x = half_background_width;\n    if (backgroundPositionVector.y < half_background_height) backgroundPositionVector.y = half_background_height;\n\n\n    if (backgroundPositionVector.x > map_width - half_background_width) backgroundPositionVector.x = map_width - half_background_width;\n    if (backgroundPositionVector.y > map_height - half_background_height) backgroundPositionVector.y = map_height - half_background_height;\n\n\n    background.x = backgroundPositionVector.x;\n    background.y = backgroundPositionVector.y;\n\n    background.rotation = - 90;\n\n\n\n\n    // let background = this.view.layer.background.map_background,\n    //     full_map_width = this.mapInfo.width,\n    //     full_map_height = this.mapInfo.height,\n    //     {x, y} = this.camera.focus,\n    //     half_window_width = this.window.width/2,\n    //     half_window_height = this.window.height/2;\n    //\n    // if(x < half_window_width) background.x = half_window_width - x;\n    // if(x > (full_map_width - half_window_width)) background.x = full_map_width - half_window_width - x;\n    //\n    // if(y < half_window_height) background.y = half_window_height - y;\n    // if(y > (full_map_height - half_window_height)) background.y = full_map_height - half_window_height - y;\n  }\n\n  updateMap() {\n    this.teams.forEach(team => {\n      team.spawn_camp.view.visible = this.camera.showing(team.spawn_camp);\n    })\n\n    this.model.map.impermeables.forEach((imp, i) => {\n      this.view.map.impermeables[i].visible = this.camera.showing(imp);\n    });\n\n  }\n\n  updateTINT() {\n    try {\n      if (TINT) TINT.setAngleOffset(-this.camera.focus.ship.rotation)\n    } catch (e) {\n      log('tint load failed')\n    }\n  }\n\n  updateGrid() {\n    var focus = this.camera.focus;\n    if (focus) GRID.offset(-focus.x, -focus.y)\n  }\n\n  updateGameViews() {\n\n    const list = this.calculateTeamScoreAppearance();\n\n    this.view.overlay.score.team.forEach((text, i) => {\n      text.text = this.game.scores[i];\n      // text.scaleX = text.scaleY = (this.teams[i] == this.game.lead ? 1 : 0.86);\n\n      if(this.gameMode == 0) // todo FIX --     export logic to another function to know which is larger\n        text.scaleX = text.scaleY = (list[i] ? 1 : 0.86);\n    })\n\n    if(this.gameMode == 0)\n      this.updateFlagView();\n\n  }\n\n  calculateTeamScoreAppearance() {\n\n    const list = [];\n\n    switch(this.gameMode) {\n\n      case 0: // ctf\n\n        for(let team of this.teams)\n          list.push(team.players.map(p => p.id).indexOf(this.game.flag.holderID) != -1)\n\n        break;\n\n      case 1: // territory\n\n        const bestScore = _(this.game.scores).max();\n        _(this.game.scores).each(score => list.push(score == bestScore))\n\n        break;\n\n    }\n\n    return list;\n  }\n\n  updateFlagView() {\n    var v = this.view.flag, flag = this.game.flag;\n\n    var not_visible = false;\n    let newPosition = new V2D(flag.position.x - this.camera.plane.regX, flag.position.y - this.camera.plane.regY)\n    newPosition.angle -= Math.radians(this.camera.focus.ship.rotation + 90)\n    newPosition.mul(this.scale)\n    newPosition.add({x: this.camera.plane.x, y: this.camera.plane.y})\n    v.x = newPosition.x;\n    v.y = newPosition.y;\n    var padding = (flag.radius * 2)\n    if (v.x < padding) {\n      v.x = padding;\n      not_visible = true;\n    }\n    if (v.x > this.window.width - padding) {\n      v.x = this.window.width - padding;\n      not_visible = true;\n    }\n    if (v.y < padding) {\n      v.y = padding;\n      not_visible = true;\n    }\n    if (v.y > this.window.height - padding) {\n      v.y = this.window.height - padding;\n      not_visible = true;\n    }\n\n    v.alpha = not_visible ? 0.3 : (flag.idle ? 1 : 0);\n\n\n    // var v = this.view.flag, flag = this.game.flag;\n    //\n    // var not_visible = false;\n    // v.x = flag.position.x + this.camera.plane.x;\n    // v.y = flag.position.y + this.camera.plane.y;\n    // var padding = (flag.radius * 2)\n    // if(v.x < padding) { v.x = padding; not_visible = true; }\n    // if(v.x > this.window.width - padding) { v.x = this.window.width - padding; not_visible = true; }\n    // if(v.y < padding) { v.y = padding; not_visible = true; }\n    // if(v.y > this.window.height - padding) { v.y = this.window.height - padding; not_visible = true; }\n    //\n    // v.alpha = not_visible ? 0.1 : (flag.idle ? 1 : 0);\n  }\n\n  updateMinimapView() {\n    let mini = this.view.overlay.minimap;\n\n    // ships\n    this.team.players.forEach((player, i) => {\n      mini.players[i].x = player.ship.position.x * mini.scale;\n      mini.players[i].y = player.ship.position.y * mini.scale;\n    })\n\n\n    // flag\n    if(this.gameMode == 0) {\n      let flag = this.game.flag;\n      mini.flag.x = flag.position.x * mini.scale;\n      mini.flag.y = flag.position.y * mini.scale;\n    }\n\n  }\n\n  updateCameraFocus() {\n    this.camera.focus = this.activePlayers[this.activePlayerIndex].ship.view;\n  }\n\n  log() {\n    // var input = this.ships.main.owner.input;\n    // var ship = this.ships.main;\n    // $('#log').text(`forward: ${input.get('forward')}, turn: ${input.get('turn')}, shoot: ${input.get('shoot')}, block: ${input.get('block')}, `)\n//     $('#log').text(\n// `    x: ${ship.position.x.round(2)}\n//     y: ${ship.position.y.round(2)}\n// angle: ${ship.angle.round(2)}`\n//     );\n\n    // FPS\n    // this.last = this.last || [];\n    // this.last.push(1/this.dt)\n    // if(this.last.length > 10) this.last.shift();\n    // $('#log').text(`fps ${Math.round(this.last.average())}`);\n  }\n\n\n  // end vs stop: end happens when the local game appears to conclude; interaction with the game is stopped\n  // and the state might even be obstructed from view though the simluation continues;\n\n  disableInteraction() {\n    this.game.disabled = true;\n    if (this.player) this.resetInput();\n    this.deinitListeners();\n    this.timer.cancel();\n  }\n\n  endSimulation() {\n    this.game.ended = true;\n    // SoundHelper.stop();\n  }\n\n  timerExpire() {\n\n    // let server know TODO this should not lie here like this..\n    switch(this.gameMode) {\n\n      case 0: // ctf\n\n        const team = this.player.team.number;\n        const score = this.game.scores[team];\n        this.network.sendFlagProgress([team, score]);\n\n        break;\n\n    }\n\n    // LOBBY.disableGame();\n\n    // disconnect if no server response after 6s\n    setTimeout(() => {\n      if (!(this.game.ended || this.game.overtime)) LOBBY.disconnect();\n    }, 6000);\n  }\n\n  takeOvertime() {\n    this.game.overtime = true;\n\n    // disconnect if no server response after 40s\n    setTimeout(() => {\n      if (!(this.game.ended)) LOBBY.disconnect();\n    }, TIME.sec(40)); // OVERTIME DURATION.. todo\n  }\n\n\n  end(results) {\n\n    // this.setScoreToResults(results);\n\n    this.game.ended = true;\n    this.disableInteraction();\n  }\n\n  setScoreToResults(results) {\n    // this.game.scores = results;\n  }\n\n  // *** NEW NETWORK STRUCTURE *** //\n\n  // ** SHIP ** //\n\n  damageShip(toID, hp, fromID) {\n\n    // interpret damage data\n    const data = [toID, hp, fromID];\n\n    // adjust locally (if possible)\n    this.adjustShipHP(data)\n\n    // send through network\n    this.network.sendAdjustShipHP(data);\n\n  }\n\n  adjustShipHP([toID, hp, fromID]) {\n\n    // health on a player can only be adjusted by own player\n    if(toID !== this.player.id) return;\n\n    // damage and send death if neccessary\n    if(this.player.ship.damage(hp))\n      this.processDeath([toID, fromID]);\n\n }\n\n  processDeath(data) {\n\n    // announce locally\n    this.deathOccurrence(data)\n\n    // send through network\n    this.network.sendDeathOccurrence(data);\n\n  }\n\n  deathOccurrence([toID, fromID]) {\n\n    const t = this.players.get(toID)\n    const g = this.players.get(fromID);\n\n    if (t) t.score.deaths++;\n    if (g) g.score.kills++;\n\n    if (this.spectate) return;\n    if (toID == this.player.id) {\n      const player = this.players.get(fromID);\n      this.alert_kill(\n        DeepSpaceGame.localizationStrings.alerts['yourDeath'][this.language](\n          player.name\n        )\n      );\n      this.camera.animateFocus(player.ship.view, [this.player.ship, 'disabled']);\n      // this.camera.animateFocus(player.ship.view, player.ship.RESPAWN_DELAY*16.7);\n    } else if (fromID == this.player.id) {\n      this.alert_kill(\n        DeepSpaceGame.localizationStrings.alerts['yourKill'][this.language](\n          this.players.get(toID).name\n        )\n      );\n    }\n\n  }\n\n  // ** PROJECTILES ** //\n\n  // * BULLETS * //\n\n  addBullet(ship) {\n    \n    // interpretation ship data for bullet creation\n    const data = this.generateBulletData(ship)\n\n    // actually create bullet object\n    this.createBullet(data)\n\n    // ditribute bullet creation data to other clients\n    this.network.sendCreateBullet(data)\n\n    // notify ship\n    ship.didShoot(data.id)\n\n  }\n\n  generateBulletData(ship) {\n\n    return ({\n      id: Math.uuid(),\n      creator: ship.owner.id,\n      team: ship.owner.team.number,\n      position: ship.shoot_position,\n      angle: ship.shoot_angle + ship.shot_RNG,\n      radius: ship.ATTACK_RADIUS,\n      hp: ship.ATTACK_HP,\n      lifespan: ship.ATTACK_LIFESPAN,\n      velocity: ship.velocity,\n      speed: ship.ATTACK_SPEED\n    });\n\n  }\n\n  createBullet(data) {\n\n    const b = new Bullet(data);\n\n    // create a view for it.\n    const cache = DeepSpaceGame.graphicsCaches.bullets[b.team];\n    const bv = new createjs.Bitmap(cache);\n    bv.scaleX = bv.scaleY = b.radius / Bullet.stats.MAX_RADIUS;\n    bv.regX = bv.regY = (cache.width / 2);\n    this.view.layer.action.back.addChild(bv);\n\n    // set model and view maps\n    this.model.bullets.set(b.id, b);\n    this.view.bullets.set(b.id, bv);\n\n    // collision groups\n    b.collision_groups = [this.physics.collision_groups.BULLETS];\n    b.collision_groups.push(this.teams[b.team] == this.team ? this.physics.collision_groups.OUR_BULLETS : this.physics.collision_groups.ENEMY_BULLETS);\n    if (!this.spectate && b.creator == this.player.id) b.collision_groups.push(this.physics.collision_groups.MY_BULLETS);\n\n  }\n\n  removeBullet(id) {\n\n    // remove local copy\n    this.destroyBullet(id)\n\n    // annouce bullet demise\n    this.network.sendDestroyBullet(id)\n\n  }\n\n  destroyBullet(id) {\n\n    var b = this.model.bullets.get(id);\n    if (!b) return;\n\n    this.clearCollisionDivisions(b);\n\n    this.model.bullets.delete(id);\n    if (!this.spectate) this.ships.main.bullets.delete(id);\n\n    // erase the view for it.\n    var v = this.view.bullets.get(id);\n    if (v) {\n      this.view.bullets.delete(id);\n      this.view.layer.action.back.removeChild(v);\n    }\n\n  }\n\n  // * BLOCKS * //\n\n  addBlock(ship) {\n\n    // interpretation ship data for block creation\n    const data = this.generateBlockData(ship)\n\n    // actually create block object\n    this.createBlock(data)\n\n    // ditribute bullet creation data to other clients\n    this.network.sendCreateBlock(data)\n\n    // notify ship\n    ship.didBlock(data.id)\n\n  }\n\n  generateBlockData(ship) {\n    return ({\n      id: Math.uuid(),\n      creator: ship.owner.id,\n      team: ship.owner.team.number,\n      position: ship.front_weapon_position,\n      angle: (ship.angle) + ((ship.BLOCK_SPREAD / 2) * ((Math.random()*2) - 1)),\n      hp: ship.BLOCK_HP_CAPACITY,\n      // radius: Math.randomIntMinMax(Block.stats.MIN_RADIUS, Block.stats.MAX_RADIUS)\n      radius: Block.stats.MAX_RADIUS,\n      speed: Math.randomIntMinMax(Block.stats.MIN_SPEED, Block.stats.MAX_SPEED)\n    });\n\n  }\n\n  createBlock(data) {\n\n    var bl = new Block(data);\n\n    // create a view for it.\n    bl.isForeign = this.spectate || bl.team != this.team.number;\n    let type = false ? 'enemy' : 'unlocked';\n    let cache = DeepSpaceGame.graphicsCaches.blocks[type][bl.team];\n    var blv = new createjs.Bitmap(cache);\n    blv.scaleX = blv.scaleY = bl.radius / Block.stats.MAX_RADIUS;\n    blv.regX = blv.regY = (cache.width / 2);\n    this.view.layer.action.back.addChild(blv);\n\n    // set model and view maps\n    this.model.blocks.set(bl.id, bl);\n    this.view.blocks.set(bl.id, blv);\n\n    // collision groups\n    bl.collision_groups = [this.physics.collision_groups.REFUGE]\n    if (this.teams[bl.team] != this.team) {\n      bl.collision_groups.push(this.physics.collision_groups.ENEMY_BLOCKS)\n    } else {\n      bl.collision_groups.push(this.physics.collision_groups.OUR_REFUGE)\n      bl.collision_groups.push(this.physics.collision_groups.OUR_BLOCKS)\n    }\n\n    // notify game\n    if(this.gameMode == 1) this.game.scores[data.team]++;\n\n  }\n\n  damageBlock(id, hp) {\n\n    // interpret damage data\n    const data = [id, hp];\n\n    // adjust locally\n    this.adjustBlockHP(data)\n\n    // send through network\n    this.network.sendAdjustBlockHP(data);\n\n  }\n\n  adjustBlockHP([id, hp]) {\n    const block = ENV.game.model.blocks.get(id);\n    if(block) block.damage(hp);\n  }\n\n  changeBlock(id, team) {\n\n    // interpret change data\n    const data = [id, team];\n\n    // adjust locally\n    this.setBlockTeam(data)\n    \n    // send through network\n    this.network.sendSetBlockTeam(data);\n\n  }\n\n  setBlockTeam([id, team]) {\n    // retrieve and store block\n    var b = this.model.blocks.get(id);\n    if (!b) return false;\n\n    // begin change if locked\n    if (b.locked) {\n\n      // skip if change is unnecessary\n      if (b.team != team) {\n\n        const oldTeam = b.team;\n\n        // assign new team\n        b.team = team;\n\n        // if not spectating add or remove from ref group\n        if (!this.spectate) {\n          if (b.team != this.team.number) {\n            this.refGroups.enemyBlocks.add(b);\n          } else {\n            this.refGroups.enemyBlocks.delete(b);\n          }\n        }\n\n        //\n        if (!this.spectate) {\n\n          this.ships.main.blocks.delete(id);\n\n\n\n        }\n\n        // replace and delete old view\n        var v = this.view.blocks.get(id);\n        if (v) {\n          let type = this.refGroups.enemyBlocks.has(b) ? 'enemy' : (b.locked ? 'locked' : 'unlocked');\n          v.image = DeepSpaceGame.graphicsCaches.blocks[type][b.team];\n          // v.updateCache();\n        }\n\n        // collision groups\n        this.clearCollisionDivisions(b);\n        b.collision_groups = [this.physics.collision_groups.REFUGE]\n        if (this.teams[b.team] != this.team) {\n          b.collision_groups.push(this.physics.collision_groups.ENEMY_BLOCKS)\n        } else {\n          b.collision_groups.push(this.physics.collision_groups.OUR_REFUGE)\n        }\n        this.setCollisionDivisions(b);\n\n        // notify game\n        if(this.gameMode == 1) {\n          this.game.scores[oldTeam]--;\n          this.game.scores[team]++;\n        }\n\n        \n      } // end if(b.team != team)\n    } // end if(!b.locked)\n\n\n  }\n\n  removeBlock(id) {\n\n    // remove local copy\n    this.destroyBlock(id)\n\n    // annouce blocks demise\n    this.network.sendDestroyBlock(id)\n\n  }\n\n  destroyBlock(id) {\n    var b = this.model.blocks.get(id);\n    if (!b) return false;\n\n    this.clearCollisionDivisions(b);\n\n    this.model.blocks.delete(id);\n    if (!this.spectate) this.ships.main.blocks.delete(id);\n\n    if (b.locked) this.refGroups.enemyBlocks.delete(b);\n\n    // erase the view for it.\n    var v = this.view.blocks.get(id);\n    if (v) {\n      this.view.blocks.delete(id);\n      this.view.layer.action.back.removeChild(v);\n    }\n    if (!this.spectate) {\n      var v = this.view.overlay.minimap.blocks.get(id);\n      if (v) {\n        this.view.overlay.minimap.blocks.delete(id);\n        this.view.overlay.minimap.removeChild(v);\n      }\n    }\n\n    // notify game\n    if(this.gameMode == 1) this.game.scores[b.team]--;\n\n    return true;\n  }\n\n  // * SUBS * //\n\n  addSub(ship) {\n\n    // interpretation ship data for sub creation\n    const data = this.generateSubData(ship)\n\n    // actually create block object\n    this.createSub(data)\n\n    // ditribute bullet creation data to other clients\n    this.network.sendCreateSub(data)\n\n    // notify ship\n    ship.didSub(data.id)\n\n  }\n\n  generateSubData(ship) {\n    return ({\n      id: Math.uuid(),\n      type: ship.SUB_TYPE,\n      team: ship.owner.team.number,\n      player: ship.owner.id,\n      position: ship.front_weapon_position,\n      angle: ship.angle\n    });\n  }\n\n  createSub(data) {\n    var p;\n    switch (data.type) {\n      case 'attractor':\n        p = new Attractor(data)\n        break;\n      case 'repulsor':\n        p = new Repulsor(data)\n        break;\n      case 'block_bomb':\n        p = new BlockBomb(data)\n        break;\n      case 'stealth_cloak':\n        p = new StealthCloak(data)\n        break;\n      case 'missile':\n        p = new Missile(data)\n        break;\n      default:\n        break;\n    }\n\n    // create a view for it.\n    if (data.type != 'stealth_cloak') {\n      let graphics = DeepSpaceGame.graphics[data.type](this.teams[p.team].color);\n      var pv = new createjs.Shape(graphics);\n      pv.cache(-12, -12, 24, 24);\n      this.view.layer.action.back.addChild(pv);\n\n      this.view.subs.set(p.id, pv);\n\n      // if(this.camera.showing(p)) SoundHelper.fireSub(); // no sound for stealth\n\n      p.collision_groups = (this.teams[p.team] == this.team) ? [this.physics.collision_groups.OUR_PROJ_SUBS] : [];\n    }\n\n    this.model.subs.set(p.id, p);\n\n    if (!this.spectate) if (p.team != this.ships.main.owner.team.number) this.refGroups.enemySubs.add(p.id);\n\n    return p;\n  }\n\n  removeSub(id) {\n\n    // remove local copy\n    this.destroySub(id)\n\n    // annouce blocks demise\n    this.network.sendDestroySub(id)\n\n  }\n\n  destroySub(id) {\n    var p = this.model.subs.get(id);\n    if (!p) return false;\n\n    this.clearCollisionDivisions(p);\n\n    this.model.subs.delete(id);\n    if (!this.spectate) this.ships.main.subs.delete(id);\n\n    this.refGroups.enemySubs.delete(p.id);\n\n    // erase the view for it.\n    if (p.type != 'stealth_cloak') {\n      var v = this.view.subs.get(id);\n      if (v) {\n        this.view.subs.delete(id);\n        this.view.layer.action.back.removeChild(v);\n      }\n    }\n    return true;\n  }\n\n  // * GAME * //\n\n  // CTF //\n\n  assumeFlag(ship) {\n\n    // interpret for flag capture\n    const id = ship.owner.id\n\n    // capture flag locally\n    this.captureFlag(id)\n\n    // let other clients know\n    this.network.sendCaptureFlag(id)\n\n    // notify ship\n    ship.didPickupFlag()\n\n  }\n\n  captureFlag(id) {\n\n    // set flag and ship state\n    const player = this.players.get(id);\n    this.game.flag.holderID = id;\n    if(this.players.get(id)) this.players.get(id).ship.setFlag(this.game.flag);\n\n    // alert\n    var c = player.team.color, us = player.team == this.team;\n    // var c = DeepSpaceGame.colors[player.team.color], us = player.team == this.team;\n    this.alert(\n      DeepSpaceGame.localizationStrings.alerts[us ? 'teamTakesFlag' : 'enemyTakesFlag'][this.language](\n        DeepSpaceGame.localizationStrings.colors[c][this.language]\n      )\n      , c);\n\n    // sound\n    // us ? SoundHelper.teamYay() : SoundHelper.teamNay();\n\n    // this.updateFlagView();\n\n  }\n\n  releaseFlag() {\n\n    // capture flag locally\n    this.dropFlag()\n\n    // let other clients know\n    this.network.sendDropFlag()\n\n    // let server know\n    const team = this.player.team.number;\n    const score = this.game.scores[team];\n    this.network.sendFlagProgress([team, score]);\n\n  }\n\n  dropFlag() {\n\n    var id, flag = this.game.flag, ship = null;\n\n    if (id = flag.holderID) {\n      var player = this.players.get(flag.holderID)\n      if (ship = player.ship)\n        ship.clearFlag();\n\n      flag.reset();\n\n      var c = player.team.color, us = player.team == this.team;\n      this.alert(\n        DeepSpaceGame.localizationStrings.alerts[us ? 'teamDropsFlag' : 'enemyDropsFlag'][this.language](\n          DeepSpaceGame.localizationStrings.colors[c][this.language]\n        )\n        , us || this.spectate ? undefined : this.team.color);\n\n      // this.updateFlagView();\n    }\n\n  }\n\n  flagProgress([team, score]) {\n\n    // update local registry w/ server score\n    this.game.scores[team] = score;\n\n  }\n\n\n\n\n  // pickupFlag(playerID) { // flag activation needs to go through here\n  //   var flag = this.game.flag, ship = null;\n  //   // if(!flag.idle) NetworkHelper.out_flag_drop();\n  //   flag.holderID = playerID;\n  //\n  //   var player = this.players.get(flag.holderID);\n  //\n  //\n  //   if (ship = player.ship) {\n  //     ship.setFlag(flag);\n  //     if(this.game.overtime)\n  //       if(ship.owner.team == this.game.lead)\n  //         if(ship.owner.team == this.team)\n  //           this.network.out_game_over(this.team.number);\n  //   }\n  //\n  //\n  //\n  //   var c = DeepSpaceGame.colors[player.team.color], us = player.team == this.team;\n  //   this.alert(\n  //     DeepSpaceGame.localizationStrings.alerts[us ? 'teamTakesFlag' : 'enemyTakesFlag'][this.language](\n  //       DeepSpaceGame.localizationStrings.colors[c][this.language]\n  //     )\n  //     , c);\n  //\n  //   // sound\n  //   us ? SoundHelper.teamYay() : SoundHelper.teamNay();\n  //\n  //   // this.updateFlagView();\n  // }\n\n  // dropFlag() {\n  //   var id, flag = this.game.flag, ship = null;\n  //   if (id = flag.holderID) {\n  //     var player = this.players.get(flag.holderID)\n  //     if (ship = player.ship)\n  //       ship.clearFlag();\n  //\n  //     flag.reset();\n  //\n  //     var c = player.team.color, us = player.team == this.team;\n  //     this.alert(\n  //       DeepSpaceGame.localizationStrings.alerts[us ? 'teamDropsFlag' : 'enemyDropsFlag'][this.language](\n  //         DeepSpaceGame.localizationStrings.colors[c][this.language]\n  //       )\n  //       , us || this.spectate ? undefined : this.team.color);\n  //\n  //     // this.updateFlagView();\n  //   }\n  //\n  // }\n\n  alert(msg, color = \"#ECEFF1\") {\n    clearTimeout(this.alertTimeout)\n    var v = this.view.overlay.message;\n    v.text = msg;\n    v.color = color;\n    if (msg.trim() !== '') this.alertTimeout = setTimeout(() => {\n      this.alert(\"\")\n    }, 4000)\n  }\n\n  alert_kill(msg, color = \"#ECEFF1\") {\n    clearTimeout(this.alertKillTimeout)\n    var v = this.view.overlay.kill_message;\n    v.text = msg;\n    v.color = color;\n    if (msg.trim() !== '') this.alertKillTimeout = setTimeout(() => {\n      this.alert_kill(\"\")\n    }, 4000)\n  }\n\n\n  msgShipKill(takerID, giverID) {//alert(`takerID ${takerID}, giverID ${giverID},`)\n    var t = this.players.get(takerID), g = this.players.get(giverID);\n    if (t) t.score.deaths++;\n    if (g) g.score.kills++;\n\n    if (this.spectate) return;\n    if (takerID == this.player.id) {\n      const player = this.players.get(giverID);\n      this.alert_kill(\n        DeepSpaceGame.localizationStrings.alerts['yourDeath'][this.language](\n          player.name\n        )\n      );\n      this.camera.animateFocus(player.ship.view, [this.player.ship, 'disabled']);\n      // this.camera.animateFocus(player.ship.view, player.ship.RESPAWN_DELAY*16.7);\n    } else if (giverID == this.player.id) {\n      this.alert_kill(\n        DeepSpaceGame.localizationStrings.alerts['yourKill'][this.language](\n          this.players.get(takerID).name\n        )\n      );\n    }\n  }\n\n\n  // inturruptions, closure and game over\n\n\n  deinit() {\n    // it must go in reverse order\n    // as children of root objects will\n    // need to know what to get removed from\n    this.deinitCaches();\n    this.deinitPhysics();\n    this.deinitInput();\n    this.deinitListeners();\n    this.deinitCamera();\n    this.deinitView();\n    this.deinitGame();\n    this.deinitModel();\n\n    delete DeepSpaceGame.runningInstance;\n  }\n\n  deinitCaches() {\n    delete this.enemyTeams;\n    delete this.enemyPlayers;\n    delete this.player;\n    delete this.team;\n\n    delete DeepSpaceGame.graphicsCaches;\n  }\n\n  deinitPhysics() {\n    delete this.refGroups;\n  }\n\n  deinitInput() {\n    var main = this.ships.main;\n    if (main) delete main.owner.input;\n  }\n\n  deinitListeners() {\n    for (let [, handler] of this.inputHandlers) {\n      window.removeEventListener('keydown', handler); // onkeydown\n      window.removeEventListener('keyup', handler); // onkeyup\n    }\n  }\n\n  deinitCamera() {\n    delete this.camera;\n  }\n\n  deinitView() {\n    delete this.view;\n    delete this.window;\n    this.stage.removeAllChildren();\n    delete this.stage;\n    delete this.colors;\n  }\n\n  deinitGame() {\n    delete this.game;\n  }\n\n  deinitModel() {\n    delete this.ships;\n    delete this.players;\n    delete this.teams;\n  }\n\n  reset() {\n\n  }\n\n  resetInput() {\n    var input;\n    if (this.player) if (input = this.player.input) input.clear();\n  }\n\n  disconnectPlayer(id) {\n    var player = this.players.get(id);\n    if (player) {\n      player.disconnected = true;\n      player.ship.disabled = true;\n      if (this.spectate) this.activePlayers.delete(player)\n    } else {\n      log(`ERR in disconnectPlayer :: id(${id}) not found`)\n    }\n  }\n\n}\n\nDeepSpaceGame.graphics = {\n  circle_fill: (color, size) => new createjs.Graphics().beginFill(color).drawCircle(0, 0, size),\n\n  spawn_camp: (color) => new createjs.Graphics().beginStroke(color).setStrokeStyle(6).drawCircle(0, 0, 64),\n  spawn_camp_fill: (color) => new createjs.Graphics().beginFill(color).drawCircle(0, 0, 64),\n  // spawn_camp: () => new createjs.Graphics().beginStroke(\"#37474F\").setStrokeStyle(4).drawCircle(0, 0, 64),\n  ship: [\n    // 0 \"standard\"\n    [(color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).moveTo(8, 0).lineTo(-8, -8).lineTo(-8, 8).lineTo(8, 0).lineTo(-8, -8),\n      (color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).beginFill(color).moveTo(8, 0).lineTo(-8, -8).lineTo(-8, 8).lineTo(8, 0).lineTo(-8, -8)],\n\n    // 1 \"rate\"\n    [(color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).moveTo(8, 0).lineTo(-4.8, -8).lineTo(-8, 0).lineTo(-4.8, 8).lineTo(8, 0).lineTo(-4.8, -8),\n      (color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).beginFill(color).moveTo(8, 0).lineTo(-4.8, -8).lineTo(-8, 0).lineTo(-4.8, 8).lineTo(8, 0).lineTo(-4.8, -8)],\n\n    // 2 \"speed\"\n    [(color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).moveTo(8, 0).lineTo(-8, -8).lineTo(-4.8, 0).lineTo(-8, 8).lineTo(8, 0).lineTo(-8, -8),\n      (color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).beginFill(color).moveTo(8, 0).lineTo(-8, -8).lineTo(-4.8, 0).lineTo(-8, 8).lineTo(8, 0).lineTo(-8, -8)],\n\n    // 3 \"defense\"\n    [(color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).moveTo(8, 0).lineTo(6.4, -4).lineTo(-8, -8).lineTo(-8, 8).lineTo(6.4, 4).lineTo(8, 0).lineTo(6.4, -4),\n      (color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).beginFill(color).moveTo(8, 0).lineTo(6.4, -4).lineTo(-8, -8).lineTo(-8, 8).lineTo(6.4, 4).lineTo(8, 0).lineTo(6.4, -4)],\n\n    // 4 \"damage\"\n    [(color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).moveTo(8, 0).lineTo(4.8, -8).lineTo(-8, -8).lineTo(-4.8, 0).lineTo(-8, 8).lineTo(4.8, 8).lineTo(8, 0).lineTo(4.8, -8),\n      (color, width) => new createjs.Graphics().beginStroke(color).setStrokeStyle(width).beginFill(color).moveTo(8, 0).lineTo(4.8, -8).lineTo(-8, -8).lineTo(-4.8, 0).lineTo(-8, 8).lineTo(4.8, 8).lineTo(8, 0).lineTo(4.8, -8)],\n\n  ],\n  particle: (color, size) => new createjs.Graphics().beginStroke(color).setStrokeStyle(4).drawCircle(0, 0, size),\n  // bullet: (color) => DeepSpaceGame.graphics.particle(color)\n  // block: (color, size) => new createjs.Graphics().beginFill(color).drawCircle(0, 0, size),\n  block_border: (color, size) => new createjs.Graphics().beginStroke(color).setStrokeStyle(2).drawCircle(0, 0, size),\n  block_fill: (color, size) => new createjs.Graphics().beginFill(color).drawCircle(0, 0, size),\n  block_center: (color) => new createjs.Graphics().beginFill(color).drawCircle(0, 0, 2),\n\n  attractor: color => new createjs.Graphics().beginFill(color).moveTo(2, 2).lineTo(2, 8).lineTo(-2, 8).lineTo(-2, 2).lineTo(-8, 2).lineTo(-8, -2).lineTo(-2, -2).lineTo(-2, -8).lineTo(2, -8).lineTo(2, -2).lineTo(8, -2).lineTo(8, 2).lineTo(2, 2),\n  repulsor: color => new createjs.Graphics().beginFill(color).moveTo(2, -8).lineTo(2, 8).lineTo(-2, 8).lineTo(-2, -8).lineTo(2, -8),//.lineTo(-8, -2).lineTo(-2, -2).lineTo(-2, -8).lineTo(2, -8).lineTo(2, -2).lineTo(8, -2).lineTo(8, 2).lineTo(2, 2),\n  block_bomb: color => new createjs.Graphics().beginFill(color).moveTo(-10, 0).arcTo(-10, -10, 0, -10, 10).lineTo(0, 10).arcTo(-9, 9, -10, 0, 10),\n  missile: color => new createjs.Graphics().beginFill(color).moveTo(6, 0).lineTo(-6, -6).lineTo(-6, 6).lineTo(6, 0),\n\n\n  ring: r => new createjs.Graphics().beginStroke(\"#ECEFF1\").setStrokeStyle(16).drawCircle(0, 0, r),\n  flag: r => new createjs.Graphics().beginFill(\"#ECEFF1\").drawCircle(0, 0, r),\n  flag_shadow: () => new createjs.Shadow(\"#ECEFF1\", 0, 0, 10),\n\n  energyMeter: (color, percent, scale, radius = 5) => new createjs.Graphics().beginFill(color).moveTo(0, 0).arc(0, 0, radius/scale, (-Math.PI / 2), (2 * Math.PI * percent) - (Math.PI / 2)),\n  energyMeterShadow: (color, scale, radius = 7) => new createjs.Graphics().beginFill(color).moveTo(0, 0).arc(0, 0, radius/scale, 0, 2 * Math.PI)\n};\n\nDeepSpaceGame.renderingParameters = {\n  'bulletCount': 100,\n  'shipThrustParticleCount': 80\n}\n\nDeepSpaceGame.localizationStrings = {\n  alerts: {\n    enemyTakesFlag: {\n      en: (color) => `The ${color} team has the moon!`\n    },\n    teamTakesFlag: {\n      en: () => `We have the moon!`\n    },\n    enemyDropsFlag: {\n      en: (color) => `The ${color} team dropped the moon!`\n    },\n    teamDropsFlag: {\n      en: () => `We dropped the moon!`\n    },\n    yourKill: {\n      en: (name) => `you got ${name}`\n    },\n    yourDeath: {\n      en: (name) => `${name} got you!`\n    },\n    teamTakesLead: {\n      en: () => `We took the lead!`\n    },\n    teamLosesLead: {\n      en: () => `We lost the lead!`\n    }\n  },\n  colors: {\n    '#FF4081': {\n      en: `pink`\n    },\n    '#FF5252': {\n      en: `red`\n    },\n    '#FFEA00': {\n      en: `yellow`\n    },\n    '#00E676': {\n      en: `green`\n    },\n    '#00B0FF': {\n      en: `blue`\n    },\n    '#BB33FF': {\n      en: `purple`\n    },\n    '#ECEFF1': {\n      en: `white`\n    },\n    '#90A4AE': {\n      en: `light`\n    },\n    '#37474F': {\n      en: `dark`\n    },\n    '#263238': {\n      en: `black`\n    },\n\n\n    '#FFA33F': {\n      en: `orange`\n    }, // 10 orange\n    '#82E600': {\n      en: `lime`\n    }, // 11 grass\n    '#00FFE2': {\n      en: `aqua`\n    }, // 12 aqua\n    '#F93FFF': {\n      en: `magenta`\n    }, // 13 magenta\n  }\n}\n\n// DeepSpaceGame.colorNames = [\n//   '#FF4081': `pink`,\n//   '#FF5252': `red`,\n//   '#FFEA00': `yellow`,\n//   '#00E676': `green`,\n//   '#00B0FF': `blue`,\n//   '#AA00FF': `purple`,\n//   '#ECEFF1': `white`,\n//   '#90A4AE': `light`,\n//   '#37474F': `dark`,\n//   '#263238': `black`\n// ];\n\n// DeepSpaceGame.colorNames = [\n//   '#FF4081', // 0 pink\n//   '#FF5252', // 1 red\n//   '#FFEA00', // 2 yellow\n//   '#00E676', // 3 green\n//   '#00B0FF', // 4 blue\n//   '#AA00FF', // 5 purple\n//   '#ECEFF1', // 6 white\n//   '#90A4AE', // 7 light\n//   '#37474F', // 8 dark\n//   '#263238'  // 9 black\n// ];\n//\n// DeepSpaceGame.colorCombinations = new Map([2, [\n//   [1, 4], // red, blue\n//   [1, 2], // red, yellow\n//   [5, 2], // purple, yellow\n//   [2, 4], // yellow, blue\n//   [2, 0], // yellow, pink\n//   [0, 4], // pink, blue\n//   [4, 3]  // blue, green\n// ]],\n// [3,[\n//\n// ]]\n// );\n\nDeepSpaceGame.colors = [\n  '#FF4081', // 0 pink\n  '#FF5252', // 1 red\n  '#FFEA00', // 2 yellow\n  '#00E676', // 3 green\n  '#00B0FF', // 4 blue\n  '#BB33FF', // 5 purple AA00FF old\n  '#ECEFF1', // 6 white\n  '#90A4AE', // 7 light\n  '#37474F', // 8 dark\n  '#263238', // 9 black\n\n  // added colors\n  '#FFA33F', // 10 orange\n  '#82E600', // 11 grass\n  '#00FFE2', // 12 aqua\n  '#F93FFF', // 13 bubble gum\n];\n\nDeepSpaceGame.maps = [\n  {\n    name: \"The Event Horizon\",\n    width: 1920, height: 1920,\n    // width: 1024, height: 1024,\n    spawn: [\n      [{x: 30, y: 30}, {x: 30, y: 60}, {x: 60, y: 60}, {x: 60, y: 30}],\n      [{x: 450, y: 290}, {x: 450, y: 260}],\n      [{x: 450, y: 290}, {x: 450, y: 260}]\n    ]\n  }\n];\n\nDeepSpaceGame.maps = [\n  { // 0\n    name: \"Wide Sky\",\n    width: 3072 * 1, height: 3072 * 1,\n    teams: [2],\n\n    spawn: [\n      // [{x: 192, y: 192}, {x: 3072 - 192, y: 3072 - 192}] // 2\n\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n      [{x: (600)+64, y: (777)+64, rotation: Math.PI}, {x: (3072 - 600)-64, y: (3072 - 777)-64, rotation: 0}, {x: (777)+64, y: (3072 - 600)-64, rotation: Math.PI/+2}, {x: (3072 - 777)-64, y: (600)+64, rotation: Math.PI/-2}, {x: (1476)+64, y: (267)+64, rotation: Math.PI/-2}, {x: (3072 - 1476)-64, y: (3072 - 267)-64, rotation: Math.PI/2}, {x: (267)+64, y: (3072 - 1476)-64, rotation: Math.PI}, {x: (3072 - 267)-64, y: (1476)+64, rotation: 0}],\n    ],\n    impermeables: {\n      copies: 4,\n      bodies: [\n        [32, // radius\n          [ 1192, 382 ],\n          [ 716, 414 ],\n          [ 1496, 87 ],\n          [ 1668, 441 ],\n          [ 1670, 849 ],\n          [ 869, 1320 ],\n          [ 276, 1270 ],\n          [ 1380, 681 ],\n          [ 344, 1228 ],\n          [ 632, 1022 ],\n          [ 427, 1256 ],\n          [ 728, 1150 ],\n          [ 140, 1096 ],\n          [ 76, 1146 ],\n          [ 716, 1064 ]\n        ],\n        [48,\n          [ 1332, 585 ],\n          [ 1021, 265 ],\n          [ 1224, 1006 ],\n          [ 520, 1308 ],\n          [ 812, 1006 ],\n          [ 536, 974 ]\n        ],\n        [64,\n          [ 408, 942 ],\n          [ 856, 878 ],\n          [ 684, 537 ],\n          [ 1160, 274 ],\n          [ 957, 761 ],\n          [ 840, 1210 ]\n        ],\n        [96,\n          [ 491, 169 ],\n          [ 860, 601 ],\n          [ 1338, 409 ]\n        ],\n        [128,\n          [1540, 569],\n        ]\n      ]\n    }\n  },\n  { // 0\n    name: \"Nautical\",\n    width: 3072 * 1, height: 3072 * 1,\n    teams: [2],\n\n    // first array is for the number of teams coresponding to the teams array\n    // second is place in the arrangement for that number of teams\n    // object is position\n    spawn: [\n      // [{x: 192, y: 192}, {x: 3072 - 192, y: 3072 - 192}] // 2\n\n      [{x: 581, y: 555, rotation: Math.PI/2}, {x: 3072 - 581, y: 3072 - 555, rotation: -Math.PI/2}, {x: 3072 - 581, y: 555, rotation: Math.PI}, {x: 581, y: 3072 - 555, rotation: 0}],\n      [{x: 581, y: 555, rotation: Math.PI/2}, {x: 3072 - 581, y: 3072 - 555, rotation: -Math.PI/2}, {x: 3072 - 581, y: 555, rotation: Math.PI}, {x: 581, y: 3072 - 555, rotation: 0}],\n      [{x: 581, y: 555, rotation: Math.PI/2}, {x: 3072 - 581, y: 3072 - 555, rotation: -Math.PI/2}, {x: 3072 - 581, y: 555, rotation: Math.PI}, {x: 581, y: 3072 - 555, rotation: 0}],\n      [{x: 581, y: 555, rotation: Math.PI/2}, {x: 3072 - 581, y: 3072 - 555, rotation: -Math.PI/2}, {x: 3072 - 581, y: 555, rotation: Math.PI}, {x: 581, y: 3072 - 555, rotation: 0}]\n    ],\n    impermeables: {\n      copies: 4,\n      bodies: [\n        [32, // radius\n          [325, 764],\n          [989, 98],\n          [746, 898],\n          [1054, 1308],\n          [1179, 1260],\n          [1514, 1308],\n          [993, 1356],\n          [534, 1308],\n          [1546, 194],\n          [1488, 130],\n          [173, 1028],\n          [173, 892],\n          [470, 880],\n          [325, 764],\n          [667, 892]\n        ],\n        [48,\n          [1218, 274],\n          [1242, 786],\n          [618, 1260],\n          [1139, 1340],\n          [238, 960],\n          [794, 818]\n        ],\n        [64,\n          [1084, 475],\n          [422, 322],\n          [914, 784],\n          [1654, 546],\n          [1279, 1219],\n          [1423, 1228]\n        ],\n        [96,\n          [298, 539],\n          [967, 610]\n        ],\n        [128,\n          [831, 411]\n        ]\n      ]\n    }\n  },\n  { // 1\n    name: \"Liftor\",\n    width: 1920, height: 1920,\n    teams: [2],\n\n    // first array is for the number of teams coresponding to the teams array\n    // second is place in the arrangement for that number of teams\n    // object is position\n    spawn: [\n      // [{x: 192, y: 192}, {x: 1920 - 192, y: 1920 - 192}] // 2\n\n      [{x: 192, y: 192}, {x: 1920 - 192, y: 1920 - 192}, {x: 1920 - 192, y: 192}, {x: 192, y: 1920 - 192}],\n      [{x: 192, y: 192}, {x: 1920 - 192, y: 1920 - 192}, {x: 1920 - 192, y: 192}, {x: 192, y: 1920 - 192}],\n      [{x: 192, y: 192}, {x: 1920 - 192, y: 1920 - 192}, {x: 1920 - 192, y: 192}, {x: 192, y: 1920 - 192}],\n      [{x: 192, y: 192}, {x: 1920 - 192, y: 1920 - 192}, {x: 1920 - 192, y: 192}, {x: 192, y: 1920 - 192}]\n    ],\n    impermeables: {\n      copies: 2,\n      bodies: [\n        [32, // radius\n          [929, 76],\n          [582, 128],\n          [696, 176],\n          [811, 226],\n          [173, 892],\n          [173, 1028]\n        ],\n        [48,\n          [1218, 274],\n          [1242, 786],\n          [238, 960]\n        ],\n        [64,\n          [1654, 546],\n          [637, 578]\n        ]\n      ]\n    }\n  },\n];\n\nDeepSpaceGame.spawn_structure = [\n  [{x: 0, y: 0}], // 1 player\n  [{x: 18, y: 0}, {x: -18, y: 0}], // 2\n  [{x: 26, y: 0}, {x: -13, y: 22}, {x: -13, y: -22}], // 3\n  [{x: 34, y: 0}, {x: 0, y: 34}, {x: -34, y: 0}, {x: 0, y: -34}], //4\n  [{x: 34, y: 0}, {x: 10, y: 32}, {x: -28, y: 20}, {x: -28, y: -20}, {x: 10, y: -32}], // 5\n  [{x: 34, y: 0}, {x: 17, y: 30}, {x: -17, y: 30}, {x: -34, y: 0}, {x: -17, y: -30}, {x: 17, y: -30}] // 6\n]\n\nDeepSpaceGame.modes = {\n  ctf: { // capture the flag\n    ring_radius: 720,\n    flag_radius: 18,\n    time_limit: FRAMES.mins(3)\n  }\n};\n"]}